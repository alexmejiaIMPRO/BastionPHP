<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bastion PHP v3.1 ‚Äî Enterprise Documentation</title>
  <meta name="description" content="Comprehensive interactive documentation for Bastion PHP v3.1 ‚Äî Service Container, DV Engine, Tailwind 4, and Process Manager." />
  <script src="https://unpkg.com/lunr/lunr.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    /* Professional theme: Dark Mode Enterprise */
    :root{
      --bg:#020617; --surface:#0f172a; --surface-2:#1e293b; --muted:#94a3b8; --text:#e2e8f0;
      --accent:#38bdf8; --accent-2:#818cf8; --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
      --glass:rgba(255,255,255,0.03); --radius:12px; --maxw:1400px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "JetBrains Mono", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    
    .container{max-width:var(--maxw);margin:0 auto;padding:20px;height:100vh;display:flex;flex-direction:column}
    
    /* Header */
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 0;border-bottom:1px solid #1e293b;flex-shrink:0}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#0c4a6e,#0284c7);display:flex;align-items:center;justify-content:center;box-shadow:0 0 20px rgba(56,189,248,0.2)}
    .logo svg{width:28px;height:28px;color:white}
    h1{font-size:22px;margin:0;color:white;font-weight:800;letter-spacing:-0.5px}
    .version-tag{background:#1e293b;color:var(--accent);padding:2px 8px;border-radius:99px;font-size:11px;font-weight:700;border:1px solid #334155;margin-left:8px}
    
    /* Search */
    .controls{display:flex;gap:10px;align-items:center}
    .search{padding:10px 16px;border-radius:10px;border:1px solid #334155;background:#0f172a;color:white;min-width:320px;font-size:14px;transition:all 0.2s}
    .search:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 3px rgba(56,189,248,0.2)}
    
    /* Layout */
    .grid{display:grid;grid-template-columns:280px 1fr;gap:32px;flex:1;overflow:hidden;margin-top:20px}
    
    /* Sidebar */
    .sidebar{overflow-y:auto;padding-right:16px;padding-bottom:40px}
    .sidebar::-webkit-scrollbar{width:4px}
    .sidebar::-webkit-scrollbar-thumb{background:#334155;border-radius:4px}
    
    .nav-group{margin-bottom:24px}
    .nav-title{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;padding-left:8px}
    
    .toc{list-style:none;padding:0;margin:0}
    .toc li{margin:2px 0}
    .toc a{display:block;color:var(--muted);text-decoration:none;padding:8px 12px;border-radius:8px;font-size:14px;font-weight:500;transition:all 0.15s;border-left:2px solid transparent}
    .toc a:hover{color:white;background:#1e293b}
    .toc a.active{background:rgba(56,189,248,0.1);color:var(--accent);border-left-color:var(--accent)}
    
    /* Content */
    .content{overflow-y:auto;padding-right:20px;padding-bottom:100px;scroll-behavior:smooth}
    .content::-webkit-scrollbar{width:8px}
    .content::-webkit-scrollbar-track{background:#0f172a}
    .content::-webkit-scrollbar-thumb{background:#334155;border-radius:4px}
    
    .section{margin-bottom:60px;scroll-margin-top:20px}
    h2{font-size:32px;margin:0 0 20px 0;color:white;font-weight:800;border-bottom:1px solid #1e293b;padding-bottom:10px}
    h3{font-size:22px;margin:30px 0 15px 0;color:white;font-weight:700}
    h4{font-size:16px;margin:20px 0 10px 0;color:var(--accent);text-transform:uppercase;letter-spacing:0.5px}
    p{line-height:1.7;margin-bottom:16px;font-size:16px}
    
    /* Cards & Code */
    .card{background:#0f172a;border:1px solid #1e293b;border-radius:var(--radius);padding:24px;margin:20px 0}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    
    pre{background:#0b101a;padding:20px;border-radius:var(--radius);overflow-x:auto;border:1px solid #1e293b;position:relative;font-family:var(--mono);font-size:13px;line-height:1.5}
    code{font-family:var(--mono);color:var(--accent)}
    p code{background:rgba(56,189,248,0.1);padding:2px 6px;border-radius:4px;font-size:0.9em}
    
    .copy{position:absolute;right:10px;top:10px;background:#1e293b;border:1px solid #334155;color:var(--muted);padding:4px 8px;border-radius:6px;font-size:11px;cursor:pointer;transition:all 0.2s}
    .copy:hover{color:white;border-color:var(--accent)}
    
    /* Tables */
    table{width:100%;border-collapse:collapse;margin:20px 0;font-size:14px}
    th{text-align:left;padding:12px;color:var(--muted);border-bottom:1px solid #334155;font-weight:600}
    td{padding:12px;border-bottom:1px solid #1e293b;color:white}
    tr:last-child td{border:none}
    
    /* Utilities */
    .tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:700;text-transform:uppercase}
    .tag-new{background:rgba(16,185,129,0.15);color:var(--success)}
    .tag-cli{background:rgba(245,158,11,0.15);color:var(--warning)}
    
    footer{margin-top:60px;padding-top:20px;border-top:1px solid #1e293b;text-align:center;color:var(--muted);font-size:13px}

    @media(max-width:1000px){.grid{grid-template-columns:1fr}.sidebar{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div>
          <h1>Bastion PHP <span class="version-tag">v3.1 Enterprise</span></h1>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="search" placeholder="Search API, CLI commands, Helpers..." />
      </div>
    </header>

    <div class="grid">
      <aside class="sidebar">
        <div class="nav-group">
          <div class="nav-title">Start Here</div>
          <ul class="toc">
            <li><a href="#overview" class="active">Overview & Architecture</a></li>
            <li><a href="#quickstart">Quickstart</a></li>
            <li><a href="#cli-bastion">Bastion CLI <span class="tag tag-cli">New</span></a></li>
          </ul>
        </div>

        <div class="nav-group">
          <div class="nav-title">Core Systems</div>
          <ul class="toc">
            <li><a href="#container">Service Container</a></li>
            <li><a href="#dv-engine">DV Engine (Views)</a></li>
            <li><a href="#router">File-Based Router</a></li>
            <li><a href="#database">Database & Facades</a></li>
          </ul>
        </div>

        <div class="nav-group">
          <div class="nav-title">Frontend</div>
          <ul class="toc">
            <li><a href="#tailwind">Tailwind v4 (Oxide)</a></li>
            <li><a href="#theming">Theme System</a></li>
            <li><a href="#htmx">HTMX Integration</a></li>
          </ul>
        </div>

        <div class="nav-group">
          <div class="nav-title">Reference</div>
          <ul class="toc">
            <li><a href="#api-ref">API Helper Reference</a></li>
            <li><a href="#cli-ref">CLI Commands</a></li>
            <li><a href="#security">Security & Audit</a></li>
          </ul>
        </div>
      </aside>

      <main class="content" id="content">
        
        <section id="overview" class="section">
          <h2>Overview & Architecture</h2>
          <p class="muted">Bastion v3.1 is an <strong>Enterprise-Grade Framework</strong> generated by a single shell script. It enforces strict standardization for multi-plant environments while maintaining high developer velocity.</p>

          <div class="grid-2">
            <div class="card">
              <h3>üèõÔ∏è Architecture</h3>
              <ul>
                <li><strong>Service Container:</strong> Full Dependency Injection.</li>
                <li><strong>DV Engine:</strong> Explicit Data View passing (No globals).</li>
                <li><strong>Facades:</strong> Clean static access to singletons.</li>
                <li><strong>Process Manager:</strong> Concurrent Dev Server.</li>
              </ul>
            </div>
            <div class="card">
              <h3>üõ°Ô∏è Security (9.5/10)</h3>
              <ul>
                <li><strong>CSRF:</strong> Auto-validated middleware.</li>
                <li><strong>CSP Nonces:</strong> Auto-generated per request.</li>
                <li><strong>Auth:</strong> Stateless JWT with refresh tokens.</li>
                <li><strong>SQL:</strong> Prepared statements via Facade.</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="quickstart" class="section">
          <h2>Quickstart</h2>
          <p>Since Bastion is self-generating, installation and startup are instantaneous.</p>

          <h3>1. Generate Project</h3>
          <pre><code>bash create-bastion-app.sh my-company-tool</code><button class="copy">Copy</button></pre>

          <h3>2. Start Environment</h3>
          <p>Bastion v3 replaces <code>php artisan serve</code> with a powerful process manager.</p>
          <pre><code>cd my-company-tool
./bastion run-dev</code><button class="copy">Copy</button></pre>
          
          <div class="card" style="border-left: 4px solid var(--success);">
            <strong>System Online:</strong>
            <p style="margin:0">Access your application at <a href="http://localhost:9876" style="color:var(--accent)">http://localhost:9876</a></p>
            <small class="muted">Default User: <code>admin@example.com</code> / <code>password</code></small>
          </div>
        </section>

        <section id="cli-bastion" class="section">
          <h2>Bastion CLI <span class="tag tag-new">v3.0 Feature</span></h2>
          <p>The <code>./bastion</code> script is the heart of the developer experience. It handles concurrency so you don't need multiple terminal tabs.</p>

          <div class="card">
            <h3><code>./bastion run-dev</code></h3>
            <p>Starts the <strong>Development Triad</strong> in parallel:</p>
            <ol>
              <li><strong>PHP Internal Server (Port 8000):</strong> The backend logic. Hidden from public access.</li>
              <li><strong>Tailwind CSS v4 Watcher:</strong> Compiles <code>resources/css/app.css</code> instantly using the Rust-based Oxide engine.</li>
              <li><strong>BrowserSync Proxy (Port 9876):</strong> The public gateway. Injects scripts to auto-reload your browser when any PHP or CSS file changes.</li>
            </ol>
          </div>

          <div class="grid-2">
            <div>
              <h4><code>./bastion run-build</code></h4>
              <p class="muted">Compiles and minifies CSS for production deployment. Run this before pushing code.</p>
            </div>
            <div>
              <h4><code>./bastion migrate</code></h4>
              <p class="muted">Runs pending database migrations found in <code>database/migrations/</code>.</p>
            </div>
          </div>
        </section>

        <section id="container" class="section">
          <h2>Service Container (DI)</h2>
          <p>Bastion v3 is built on <code>App\Core\Container</code>. Services are registered as singletons in <code>App.php</code>.</p>

          <pre><code>// App\Core\App.php
private function registerServices() {
    // Database Singleton (One connection per request)
    $this->singleton(DB::class, fn() => new DB());
    
    // Auth Singleton
    $this->singleton(Auth::class, fn() => new Auth());
}</code><button class="copy">Copy</button></pre>

          <h3>Resolving Services</h3>
          <pre><code>$db = App::getInstance()->resolve(DB::class);</code><button class="copy">Copy</button></pre>
        </section>

        <section id="dv-engine" class="section">
          <h2>DV (Data View) Engine</h2>
          <p>The DV Engine replaces the practice of using global variables. It ensures data is passed explicitly to views.</p>

          <h3>1. Setting Data (in Route)</h3>
          <pre><code>use App\Core\DV;

DV::set('title', 'Production Dashboard');
DV::set('stats', ['efficiency' => 98]);</code><button class="copy">Copy</button></pre>

          <h3>2. Rendering (in View)</h3>
          <p>The <code>view()</code> helper extracts these variables locally.</p>
          <pre><code>&lt;h1&gt;&lt;?= $title ?&gt;&lt;/h1&gt;
&lt;p&gt;Efficiency: &lt;?= $stats['efficiency'] ?&gt;%&lt;/p&gt;</code><button class="copy">Copy</button></pre>
        </section>

        <section id="router" class="section">
          <h2>File-Based Routing</h2>
          <p>Routes are defined by your folder structure in <code>app/</code>. No configuration files required.</p>

          <table>
            <thead><tr><th>File Path</th><th>URL</th><th>Type</th></tr></thead>
            <tbody>
              <tr><td><code>app/page.php</code></td><td><code>/</code></td><td>Home</td></tr>
              <tr><td><code>app/about/page.php</code></td><td><code>/about</code></td><td>Static</td></tr>
              <tr><td><code>app/users/[id]/page.php</code></td><td><code>/users/123</code></td><td>Dynamic</td></tr>
              <tr><td><code>app/api/users/+server.php</code></td><td><code>/api/users</code></td><td>API</td></tr>
            </tbody>
          </table>

          <h3>Dynamic Parameters</h3>
          <p>When using folders like <code>[id]</code>, the router injects the value into the DV Engine.</p>
          <pre><code>// app/users/[id]/page.php
$id = $params['id']; 
$user = DB::table('users')->where('id', $id)->first();</code><button class="copy">Copy</button></pre>
        </section>

        <section id="tailwind" class="section">
          <h2>Tailwind CSS v4 (Oxide)</h2>
          <p>Bastion v3 uses the native Tailwind v4 engine. Configuration is done in CSS, not JS.</p>

          <pre><code>/* resources/css/app.css */
@import "tailwindcss";

/* Manual Dark Mode Strategy */
@variant dark (&:where(.dark, .dark *));

/* Theme Configuration */
@theme {
  --font-sans: "Inter", system-ui, sans-serif;
  --color-brand: #3b82f6;
}</code><button class="copy">Copy</button></pre>
        </section>

        <section id="api-ref" class="section">
          <h2>Helper Reference</h2>
          
          <div class="card">
            <div class="api-signature"><strong>view(string $path, array $data = [])</strong></div>
            <p class="muted">Renders a view using the DV Engine.</p>

            <div class="api-signature" style="margin-top:12px"><strong>env(string $key, mixed $default)</strong></div>
            <p class="muted">Safely retrieves environment variables.</p>

            <div class="api-signature" style="margin-top:12px"><strong>e(string $value)</strong></div>
            <p class="muted">Escapes HTML entities (XSS protection).</p>

            <div class="api-signature" style="margin-top:12px"><strong>auth()</strong></div>
            <p class="muted">Returns the currently authenticated <code>User</code> model or null.</p>

            <div class="api-signature" style="margin-top:12px"><strong>csrf_field()</strong></div>
            <p class="muted">Generates a hidden input field with the CSRF token.</p>
          </div>
        </section>

        <section id="security" class="section">
          <h2>Security Architecture</h2>
          <p>Bastion v3.1 is secure by default.</p>
          <div class="grid-2">
            <div>
              <h4>CSRF Protection</h4>
              <p class="muted">Middleware automatically verifies tokens on all state-changing requests (POST/PUT/DELETE).</p>
            </div>
            <div>
              <h4>CSP Nonces</h4>
              <p class="muted">A unique cryptographic nonce is generated per request (<code>$req->meta['csp_nonce']</code>) for inline scripts.</p>
            </div>
            <div>
              <h4>Path Traversal</h4>
              <p class="muted">The Request handler sanitizes all inputs to prevent directory traversal attacks.</p>
            </div>
            <div>
              <h4>Session Fixation</h4>
              <p class="muted">Session IDs are automatically regenerated upon successful login.</p>
            </div>
          </div>
        </section>

        <footer>
          <p>Bastion PHP Framework v3.1 Enterprise</p>
          <div class="muted">Built for Stability, Speed, and Standardization.</div>
        </footer>

      </main>
    </div>
  </div>

  <script>
    // --- SEARCH FUNCTIONALITY ---
    const searchInput = document.getElementById('search');
    const sections = document.querySelectorAll('section');
    
    // Build simple index
    const index = [];
    sections.forEach(sec => {
      const h2 = sec.querySelector('h2');
      if(h2) index.push({ id: sec.id, text: sec.innerText.toLowerCase(), title: h2.innerText });
    });

    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      if(!term) {
        sections.forEach(s => s.style.display = 'block');
        return;
      }
      sections.forEach(s => {
        const text = s.innerText.toLowerCase();
        s.style.display = text.includes(term) ? 'block' : 'none';
      });
    });

    // --- COPY BUTTONS ---
    document.querySelectorAll('.copy').forEach(btn => {
      btn.addEventListener('click', () => {
        const code = btn.parentElement.querySelector('code').innerText;
        navigator.clipboard.writeText(code);
        const original = btn.innerText;
        btn.innerText = 'Copied!';
        setTimeout(() => btn.innerText = original, 2000);
      });
    });

    // --- ACTIVE LINK HIGHLIGHTING ---
    const links = document.querySelectorAll('.toc a');
    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (pageYOffset >= sectionTop - 100) {
          current = section.getAttribute('id');
        }
      });
      links.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').includes(current)) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
