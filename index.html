<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bastion PHP v1 ‚Äî Enterprise Documentation</title>
  <meta name="description" content="Comprehensive interactive documentation for Bastion PHP v1 ‚Äî Service Container, DV Engine, Tailwind 4, and Process Manager." />
  <script src="https://unpkg.com/lunr/lunr.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    /* Professional theme: Dark Mode Enterprise (Preserved from your request) */
    :root{
      --bg:#071428; --surface:#0b1220; --muted:#98a0b3; --accent:#64d5ff; --accent-2:#a78bfa;
      --glass:rgba(255,255,255,0.03); --radius:14px; --maxw:1300px; --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      --gradient-accent: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,#071428 0%,#081225 100%);color:#e6eef8;-webkit-font-smoothing:antialiased}
    
    .container{max-width:var(--maxw);margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding-bottom:8px;border-bottom:1px solid rgba(100,213,255,0.06)}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#072338,#0b2236);display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(20,40,70,0.6)}
    .logo svg{width:30px;height:30px;filter:drop-shadow(0 0 16px rgba(100,213,255,0.2))}
    h1{font-size:20px;margin:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;color:transparent;font-weight:800}
    .hdr-meta{color:var(--muted);font-size:13px}
    
    .controls{display:flex;gap:10px;align-items:center}
    .search{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--surface);color:var(--muted);min-width:280px}
    .btn{background:var(--gradient-accent);border:none;padding:8px 12px;border-radius:10px;color:#041026;font-weight:800;cursor:pointer}
    
    .grid{display:grid;grid-template-columns:320px 1fr;gap:28px;margin-top:20px}
    .sidebar{position:sticky;top:28px;height:calc(100vh - 56px);overflow:auto;padding:18px;border-radius:var(--radius);background:linear-gradient(135deg,rgba(11,18,32,0.7),rgba(7,16,36,0.85));border:1px solid rgba(100,213,255,0.06)}
    
    .toc{list-style:none;padding:0;margin:0}
    .toc li{margin:6px 0}
    .toc a{display:block;color:var(--muted);text-decoration:none;padding:8px;border-radius:8px;font-weight:600;transition:all 0.2s}
    .toc a:hover,.toc a.active{background:linear-gradient(90deg,rgba(100,213,255,0.06),rgba(167,139,250,0.03));color:#fff;transform:translateX(6px)}
    .nav-title{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-top:24px;margin-bottom:8px;padding-left:8px}
    
    .content{padding:28px;border-radius:var(--radius);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));min-height:80vh;border:1px solid rgba(100,213,255,0.04)}
    .section{margin-bottom:60px;scroll-margin-top:20px}
    h2{font-size:30px;margin:0 0 20px 0;color:#fff;font-weight:800;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(100,213,255,0.1);padding-bottom:10px}
    h3{font-size:20px;margin-top:30px;margin-bottom:12px;color:#fff;font-weight:700}
    h4{font-size:16px;margin-top:20px;margin-bottom:10px;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
    p{line-height:1.7;margin-bottom:16px;font-size:16px;color:#cbd5e1}
    
    /* Code Blocks */
    pre{background:#021126;padding:18px;border-radius:12px;overflow:auto;border:1px solid rgba(100,213,255,0.06);position:relative;font-family:var(--mono);font-size:13px}
    code{color:#bfe9ff;font-family:var(--mono)}
    p code{background:rgba(100,213,255,0.1);padding:2px 6px;border-radius:4px;font-size:0.9em;color:var(--accent)}
    .copy{position:absolute;right:12px;top:12px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:700}
    
    /* Cards */
    .card{background:var(--glass);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);margin:20px 0}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    
    /* Tables */
    table{width:100%;border-collapse:collapse;margin:20px 0;font-size:14px}
    th{text-align:left;padding:12px;color:var(--accent);border-bottom:1px solid rgba(255,255,255,0.1);font-weight:700;text-transform:uppercase;font-size:12px}
    td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.03);color:#d7e6f5}
    tr:hover{background:rgba(255,255,255,0.02)}
    
    /* Utilities */
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:rgba(100,213,255,0.1);color:var(--accent);font-weight:700;font-size:11px;margin-left:8px;border:1px solid rgba(100,213,255,0.2)}
    .badge-new{background:rgba(167,139,250,0.15);color:var(--accent-2);border-color:rgba(167,139,250,0.3)}
    
    .api-signature{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;border-left:4px solid var(--accent);font-family:var(--mono);color:#bfe9ff;margin-bottom:8px}
    
    /* Feature Grid */
    .feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:28px 0}
    .feature-card{background:linear-gradient(135deg,rgba(11,18,32,0.6),rgba(7,16,36,0.8));padding:24px;border-radius:12px;border:1px solid rgba(100,213,255,0.1);transition:transform 0.2s}
    .feature-card:hover{transform:translateY(-4px);border-color:rgba(100,213,255,0.3);box-shadow:0 10px 30px rgba(0,0,0,0.3)}
    
    footer{margin-top:60px;padding-top:30px;border-top:1px solid rgba(255,255,255,0.05);text-align:center;color:var(--muted);font-size:13px}

    @media(max-width:980px){.grid{grid-template-columns:1fr}.sidebar{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><rect width="40" height="40" rx="8" fill="#072338"/><path d="M10 20h20M10 12h20M10 28h20" stroke="#64d5ff" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
        <div>
          <h1>Bastion PHP <span class="badge badge-new">v1 Enterprise</span></h1>
          <div class="hdr-meta">Service Container ‚Ä¢ DV Engine ‚Ä¢ Tailwind v4 ‚Ä¢ CLI Manager</div>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="search" placeholder="Press / to search API, CLI, Guides..." aria-label="Search documentation" />
      </div>
    </header>

    <div class="grid">
      <aside class="sidebar">
        <div class="nav-title">Start Here</div>
        <ul class="toc">
          <li><a href="#overview" class="active">Overview & Stats</a></li>
          <li><a href="#quickstart">Quickstart</a></li>
          <li><a href="#cli-bastion">Bastion CLI <span class="badge badge-new">New</span></a></li>
        </ul>

        <div class="nav-title">Core Architecture</div>
        <ul class="toc">
          <li><a href="#container">Service Container</a></li>
          <li><a href="#dv-engine">DV Engine (Views)</a></li>
          <li><a href="#router">File-Based Routing</a></li>
          <li><a href="#database">Database & Facades</a></li>
        </ul>

        <div class="nav-title">Frontend</div>
        <ul class="toc">
          <li><a href="#tailwind">Tailwind v4 (Oxide)</a></li>
          <li><a href="#theming">Theme System</a></li>
          <li><a href="#components">Components & HTMX</a></li>
        </ul>

        <div class="nav-title">Security & API</div>
        <ul class="toc">
          <li><a href="#security">Security Features</a></li>
          <li><a href="#auth">Authentication (JWT)</a></li>
          <li><a href="#api-ref">Helper Reference</a></li>
          <li><a href="#deployment">Deployment</a></li>
        </ul>
      </aside>

      <main class="content" id="content">
        
        <section id="overview" class="section">
          <h2>Overview</h2>
          <p>Bastion v1 is an <strong>Enterprise-Grade Framework</strong> generated by a single shell script. It enforces strict standardization for multi-plant environments while maintaining high developer velocity.</p>

          <div class="feature-grid">
            <div class="feature-card">
              <h4>üèõÔ∏è Architecture</h4>
              <p>Full Dependency Injection (Container), Facades for DX, and explicit Data View (DV) passing.</p>
            </div>
            <div class="feature-card">
              <h4>‚ö° Performance</h4>
              <p>Concurrent Dev Server, SQLite WAL mode (100x faster), and pre-compiled Tailwind v4.</p>
            </div>
            <div class="feature-card">
              <h4>üõ°Ô∏è Security (9.5/10)</h4>
              <p>CSRF, CSP Nonces, Path Traversal blocks, and Session Fixation prevention built-in.</p>
            </div>
            <div class="feature-card">
              <h4>üöÄ Modern Stack</h4>
              <p>Tailwind Oxide Engine (Zero Config), HTMX ready, and file-based routing.</p>
            </div>
          </div>
          
          <div class="card">
             <div class="flex" style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <strong>Test Coverage Snapshot</strong>
                    <div class="muted" style="font-size:13px; margin-top:4px">36 Integration Tests Passing</div>
                </div>
                <div style="width:200px">
                    <canvas id="overviewChart" width="200" height="60"></canvas>
                </div>
             </div>
          </div>
        </section>

        <section id="quickstart" class="section">
          <h2>Quickstart</h2>
          <p>Since Bastion is self-generating, installation and startup are instantaneous.</p>

          <ol>
            <li>
                <strong>Generate Project</strong>
                <pre><code>bash create-bastion-app.sh my-tool</code><button class="copy">Copy</button></pre>
            </li>
            <li>
                <strong>Start Environment</strong>
                <p>Bastion v3 replaces <code>php artisan serve</code> with a powerful process manager.</p>
                <pre><code>cd my-tool
./bastion run-dev</code><button class="copy">Copy</button></pre>
            </li>
          </ol>
          
          <div class="card" style="border-left: 4px solid var(--success);">
            <strong>System Online</strong>
            <div class="muted" style="margin-top:8px">
              Access URL: <a href="http://localhost:9876" style="color:var(--accent);font-weight:bold">http://localhost:9876</a><br>
              Default Admin: <code>admin@example.com</code> / <code>password</code>
            </div>
          </div>
        </section>

        <section id="cli-bastion" class="section">
          <h2>Bastion CLI <span class="badge badge-new">Process Manager</span></h2>
          <p>The <code>./bastion</code> script is the heart of the developer experience. It handles concurrency so you don't need multiple terminal tabs.</p>

          <div class="card">
            <h3><code>./bastion run-dev</code></h3>
            <p>Starts the <strong>Development Triad</strong> in parallel:</p>
            <ul>
              <li><strong>PHP Internal Server (Port 8000):</strong> The backend logic. Hidden.</li>
              <li><strong>Tailwind CSS v4 Watcher:</strong> Compiles <code>resources/css/app.css</code> instantly using Rust.</li>
              <li><strong>BrowserSync Proxy (Port 9876):</strong> Public gateway with Live Reload.</li>
            </ul>
          </div>

          <div class="grid-2">
            <div>
              <h4><code>./bastion run-build</code></h4>
              <p class="muted">Compiles and minifies CSS for production. Run this before pushing code.</p>
            </div>
            <div>
              <h4><code>./bastion migrate</code></h4>
              <p class="muted">Runs pending database migrations from <code>database/migrations/</code>.</p>
            </div>
          </div>
        </section>

        <section id="container" class="section">
          <h2>Service Container (DI)</h2>
          <p>Bastion v3 is built on <code>App\Core\Container</code>. Services are registered as singletons.</p>

          <pre><code>// App\Core\App.php
private function registerServices() {
    // Database Singleton (One connection per request)
    $this->singleton(DB::class, fn() => new DB());
    
    // Auth Singleton
    $this->singleton(Auth::class, fn() => new Auth());
}</code><button class="copy">Copy</button></pre>

          <h3>Resolving Services</h3>
          <pre><code>$db = App::getInstance()->resolve(DB::class);</code><button class="copy">Copy</button></pre>
        </section>

        <section id="dv-engine" class="section">
          <h2>DV (Data View) Engine</h2>
          <p>The DV Engine replaces global variables. It ensures data is passed explicitly to views.</p>

          <h3>1. Setting Data (in Route)</h3>
          <pre><code>use App\Core\DV;

DV::set('title', 'Production Dashboard');
DV::set('stats', ['efficiency' => 98]);</code><button class="copy">Copy</button></pre>

          <h3>2. Rendering (in View)</h3>
          <p>The <code>view()</code> helper extracts these variables locally.</p>
          <pre><code>&lt;h1&gt;&lt;?= $title ?&gt;&lt;/h1&gt;
&lt;p&gt;Efficiency: &lt;?= $stats['efficiency'] ?&gt;%&lt;/p&gt;</code><button class="copy">Copy</button></pre>
        </section>

        <section id="router" class="section">
          <h2>File-Based Routing</h2>
          <p>Routes are defined by your folder structure in <code>app/</code>. No configuration files required.</p>

          <table>
            <thead><tr><th>File Path</th><th>URL</th><th>Type</th></tr></thead>
            <tbody>
              <tr><td><code>app/page.php</code></td><td><code>/</code></td><td>Home</td></tr>
              <tr><td><code>app/about/page.php</code></td><td><code>/about</code></td><td>Static</td></tr>
              <tr><td><code>app/users/[id]/page.php</code></td><td><code>/users/123</code></td><td>Dynamic</td></tr>
              <tr><td><code>app/api/users/+server.php</code></td><td><code>/api/users</code></td><td>API</td></tr>
            </tbody>
          </table>

          <h3>Dynamic Parameters</h3>
          <p>When using folders like <code>[id]</code>, the router injects the value into the DV Engine.</p>
          <pre><code>// app/users/[id]/page.php
$id = $params['id']; 
$user = DB::table('users')->where('id', $id)->first();</code><button class="copy">Copy</button></pre>
        </section>

        <section id="tailwind" class="section">
          <h2>Tailwind CSS v4 (Oxide)</h2>
          <p>Bastion v3 uses the native Tailwind v4 engine. Configuration is done in CSS, not JS.</p>

          <pre><code>/* resources/css/app.css */
@import "tailwindcss";

/* Manual Dark Mode Strategy */
@variant dark (&:where(.dark, .dark *));

/* Theme Configuration */
@theme {
  --font-sans: "Inter", system-ui, sans-serif;
  --color-brand: #3b82f6;
}</code><button class="copy">Copy</button></pre>
        </section>

        <section id="components" class="section">
          <h2>Components & HTMX</h2>
          <p>Use PHP functions as components for composability.</p>

          <pre><code>// app/components/Card.php
function Card($title, $slot) {
    return "&lt;div class='p-4 border'&gt;&lt;h3&gt;$title&lt;/h3&gt;$slot&lt;/div&gt;";
}

// In page.php
echo Card('User Info', UserProfile($user));</code><button class="copy">Copy</button></pre>

          <h3>HTMX Form Example</h3>
          <pre><code>&lt;form hx-post="/api/users" hx-swap="none"&gt;
    &lt;input name="email" required&gt;
    &lt;?= csrf_field() ?&gt;
    &lt;button&gt;Save&lt;/button&gt;
&lt;/form&gt;</code><button class="copy">Copy</button></pre>
        </section>

        <section id="api-ref" class="section">
          <h2>Helper Reference</h2>
          
          <div class="card">
            <div class="api-signature"><strong>view(string $path, array $data = [])</strong></div>
            <p class="muted">Renders a view using the DV Engine.</p>

            <div class="api-signature" style="margin-top:12px"><strong>env(string $key, mixed $default)</strong></div>
            <p class="muted">Safely retrieves environment variables.</p>

            <div class="api-signature" style="margin-top:12px"><strong>e(string $value)</strong></div>
            <p class="muted">Escapes HTML entities (XSS protection).</p>

            <div class="api-signature" style="margin-top:12px"><strong>auth()</strong></div>
            <p class="muted">Returns the currently authenticated <code>User</code> model or null.</p>

            <div class="api-signature" style="margin-top:12px"><strong>csrf_field()</strong></div>
            <p class="muted">Generates a hidden input field with the CSRF token.</p>
          </div>
        </section>

        <section id="security" class="section">
          <h2>Security & Audit</h2>
          <p>Bastion v1 is secure by default.</p>
          <div class="grid-2">
            <div class="card">
              <h4>CSRF Protection</h4>
              <p class="muted">Middleware automatically verifies tokens on all state-changing requests (POST/PUT/DELETE).</p>
            </div>
            <div class="card">
              <h4>CSP Nonces</h4>
              <p class="muted">A unique cryptographic nonce is generated per request (<code>$req->meta['csp_nonce']</code>) for inline scripts.</p>
            </div>
            <div class="card">
              <h4>Path Traversal</h4>
              <p class="muted">The Request handler sanitizes all inputs to prevent directory traversal attacks.</p>
            </div>
            <div class="card">
              <h4>SQL Injection</h4>
              <p class="muted">QueryBuilder uses PDO Prepared Statements for all operations.</p>
            </div>
          </div>
        </section>

        <section id="deployment" class="section">
          <h2>Production Deployment</h2>
          <p>Follow these steps to deploy to a Linux/Apache/Nginx server.</p>

          <ol>
            <li>
                <strong>Clone & Install</strong>
                <pre><code>git clone repo.git .
composer install --no-dev
npm install</code><button class="copy">Copy</button></pre>
            </li>
            <li>
                <strong>Build Assets</strong>
                <p>This compiles Tailwind configuration into a static CSS file.</p>
                <pre><code>./bastion run-build</code><button class="copy">Copy</button></pre>
            </li>
            <li>
                <strong>Configure Environment</strong>
                <pre><code>APP_ENV=production
APP_DEBUG=false
DB_CONNECTION=mysql  # Recommended for heavy loads</code><button class="copy">Copy</button></pre>
            </li>
          </ol>
        </section>

        <footer>
          <p><strong>Bastion PHP Framework</strong> ‚Äî Version 3.1.0 Enterprise</p>
          <div class="muted">Built for Manufacturing, Engineered for Scale.</div>
        </footer>

      </main>
    </div>
  </div>

  <script>
    // --- SEARCH ---
    const searchInput = document.getElementById('search');
    const sections = document.querySelectorAll('section');
    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      sections.forEach(s => {
        const text = s.innerText.toLowerCase();
        s.style.display = term && !text.includes(term) ? 'none' : 'block';
      });
    });

    // --- COPY BUTTONS ---
    document.querySelectorAll('.copy').forEach(btn => {
      btn.addEventListener('click', () => {
        const code = btn.parentElement.querySelector('code').innerText;
        navigator.clipboard.writeText(code);
        const original = btn.innerText;
        btn.innerText = 'Copied!';
        setTimeout(() => btn.innerText = original, 2000);
      });
    });

    // --- CHART ---
    const ctx = document.getElementById('overviewChart');
    if(ctx) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Security', 'Speed', 'Size'],
                datasets: [{
                    label: 'Score',
                    data: [9.5, 9.8, 10],
                    backgroundColor: ['#10b981', '#38bdf8', '#a78bfa']
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { ticks: { color: '#94a3b8' } } } }
        });
    }
  </script>
</body>
</html>
