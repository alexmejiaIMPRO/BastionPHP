<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Bastion PHP 0.1.0 â€“ Developer Documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Tailwind via CDN (always ON for this docs page) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body { scroll-behavior: smooth; }
    pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">

<header class="border-b border-slate-800 bg-slate-900/80 px-4 py-3 sticky top-0 z-40 backdrop-blur">
  <div class="max-w-6xl mx-auto flex items-center gap-3">
    <div class="h-8 w-8 bg-blue-500/10 border border-blue-500/40 text-blue-400 flex items-center justify-center rounded-lg text-xs font-semibold">
      BP
    </div>
    <div>
      <h1 class="text-lg font-bold">
        Bastion PHP <span class="text-xs font-normal text-slate-400">v0.1.0</span>
      </h1>
      <p class="text-xs text-slate-400">
        Secure, file-based, zero-magic PHP framework for internal tools
      </p>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8 space-y-12">

  <!-- 1. Overview -->
  <section id="overview" class="space-y-4">
    <h2 class="text-3xl font-bold">1. Overview</h2>
    <p class="text-sm text-slate-300">
      Bastion PHP is a framework that is <strong>generated by the scaffold script</strong> and then used as a
      <strong>runtime engine</strong>. It focuses on:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><strong>Filesystem-based routing</strong> (Next.js style) with <code>page.php</code>, <code>layout.php</code>, and <code>[param]</code> folders.</li>
      <li><strong>API endpoints</strong> in <code>+server.php</code> files (FastAPI/SvelteKit style method maps).</li>
      <li><strong>Security first</strong>: CSP with nonce, CSRF tokens, SameSite/HttpOnly cookies, and strict escaping with <code>e()</code>.</li>
      <li><strong>PDO QueryBuilder</strong> facade (<code>DB::table()</code>) with SQLite + WAL by default.</li>
      <li><strong>DV Engine</strong> (Data View) to share metadata (like titles) between pages/layouts.</li>
      <li><strong>Components</strong> (server-side + HTMX interactive) that imitate Reactâ€™s composable UI approach using only PHP + HTML.</li>
      <li><strong>CLI</strong> (<code>bastion</code>) for dev server, migrations, seeding, and future scaffolding commands.</li>
    </ul>
  </section>

  <!-- 2. Project Structure -->
  <section id="structure" class="space-y-4">
    <h2 class="text-3xl font-bold">2. Generated Structure</h2>
    <p class="text-sm text-slate-400">
      The scaffold script creates an opinionated folder structure. Every directory exists for a reason:
      where to put routes, layouts, core classes, models, migrations, seeds, and logs.
    </p>

    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 overflow-x-auto text-xs">
app/                        â†’ All routable features & API resources.
  layout.php                â†’ Root HTML shell. Injects &lt;title&gt; from DV and global CSP nonce.
  page.php                  â†’ "/" page body. Only HTML fragment, no &lt;html&gt;&lt;head&gt;.
  Core/                     â†’ Framework foundation:
    App.php                 â†’ Bootstraps container, Request, middleware pipeline, router dispatch.
    Container.php           â†’ Very small DI container for shared services (DB, Auth, Logger, etc).
    Router.php              â†’ Filesystem router. Supports static pages, [param] folders, +server.php endpoints.
    Request.php             â†’ Normalized HTTP request; inputs, headers, validate(), JSON body parsing.
    Response.php            â†’ Response helpers (json/html/redirect/abort).
    DB.php                  â†’ PDO wrapper + QueryBuilder facade. Configures SQLite with WAL.
    DV.php                  â†’ Data View engine (shared view bag).
    Auth.php                â†’ JWT access tokens + DB-backed refresh tokens; role helpers.
    CSRF.php                â†’ CSRF token generation/validation helpers.
    Logger.php              â†’ Simple logger writing to storage/logs/app.log.
    Theme.php               â†’ UI theme helpers (dark/light/system).
    helpers.php             â†’ Global helpers: e(), env(), view(), auth(), csrf_token(), csrf_field(), logger()...
  Middleware/               â†’ Cross-cutting behavior:
    SecurityHeaders.php     â†’ Sets CSP with nonce, X-Frame-Options, X-Content-Type-Options, Referrer-Policy.
    RateLimit.php           â†’ Stub for IP/user throttling; easy to extend.
    AuthMiddleware.php      â†’ Injects user into Request; glues Auth + CSRF into the pipeline.
    AdminOnly.php           â†’ Guard for admin-only sections.
  Models/                   â†’ Your domain models, starting with:
    User.php                â†’ Static-based model: find, findByEmail, all, create, updateUser, deleteUser.
  Services/                 â†’ Place for external APIs, business services, helpers, etc.
  admin/                    â†’ Admin module:
    layout.php              â†’ Admin layout (sidebar, header, etc).
    page.php                â†’ "/admin" dashboard.
  login/
    page.php                â†’ "/login" â€“ form uses csrf_field(), posts to /api/auth/login.
  logout/
    page.php                â†’ "/logout" â€“ clears cookies and redirects/logs out.
  api/
    auth/
      login/+server.php     â†’ POST /api/auth/login (JWT + refresh issue).
      logout/+server.php    â†’ POST /api/auth/logout (clear cookies).
      refresh/+server.php   â†’ POST /api/auth/refresh (rotate refresh token).
    users/
      +server.php           â†’ /api/users (GET list, POST create).
      [id]/+server.php      â†’ /api/users/{id} (GET, PUT, DELETE).
config/
  app.php                   â†’ Core app config (env names, debug flags, etc).
  database.php              â†’ DB connection info.
  security.php              â†’ Security related toggles (cookies, CSRF, etc).
  style.php                 â†’ Controls Tailwind mode, theme, fallback CSS.
database/
  migrations/*.sql          â†’ Raw SQL migrations (users table, refresh_tokens table, etc).
  seeds/*.php               â†’ Seeders (UsersSeeder.php, etc).
public/
  index.php                 â†’ Front controller; creates App and calls run().
  css/fallback.css          â†’ Minimal CSS if you don't want Tailwind for actual app pages.
storage/
  db/app.db                 â†’ SQLite DB file; WAL mode enabled by DB service.
  logs/app.log              â†’ Log file used by Logger.
bastion                     â†’ CLI: run-dev, migrate, seed, key:generate, jwt:secret, (future make:* commands).
artisan                     â†’ Optional shim alias to bastion for compatibility.</pre>
  </section>

  <!-- 3. Environment & Config -->
  <section id="config-env" class="space-y-4">
    <h2 class="text-3xl font-bold">3. Environment &amp; Config</h2>

    <h3 class="text-xl font-semibold">3.1 .env usage</h3>
    <p class="text-sm text-slate-300">
      The framework uses a <code>.env</code> file for configuration. Values are read using the global <code>env()</code> helper,
      then used by core classes and helpers:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>APP_ENV</code> â€“ <code>development</code> or <code>production</code>. Affects cookie Secure and error detail.</li>
      <li><code>APP_DEBUG</code> â€“ toggles stack traces and detailed error pages.</li>
      <li><code>APP_KEY</code> â€“ a random key (generated by <code>bastion key:generate</code>) for encryption utilities.</li>
      <li><code>DB_CONNECTION</code> â€“ currently <code>sqlite</code> by default.</li>
      <li><code>DB_PATH</code> â€“ path to the sqlite file (usually <code>storage/db/app.db</code>).</li>
      <li><code>JWT_SECRET</code>, <code>JWT_TTL</code>, <code>JWT_REFRESH_TTL</code> â€“ control JWT signing and expiration.</li>
      <li><code>SECURE_COOKIES</code> â€“ if true, cookies set Secure flag in prod.</li>
      <li><code>CSRF_ENABLED</code> â€“ if true, CSRF is enforced on unsafe methods.</li>
    </ul>

    <h3 class="text-xl font-semibold">3.2 style.php</h3>
    <p class="text-sm text-slate-300">
      The <code>config/style.php</code> file controls how this docs layout and your app layouts use styles:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>theme</code> â€“ one of <code>dark</code>, <code>light</code>, or <code>system</code>.</li>
      <li><code>useTailwind</code> â€“ if true, the layout uses Tailwind CDN and utility classes.</li>
      <li><code>tailwindMode</code> â€“ <code>cdn</code> (for docs / dev) or <code>build</code> (for Tailwind CLI builds).</li>
      <li><code>fallbackCss</code> â€“ path to <code>public/css/fallback.css</code> for minimal styling if you turn off Tailwind.</li>
    </ul>
  </section>

  <!-- 4. DV Engine (Data View) -->
  <section id="dv-engine" class="space-y-4">
    <h2 class="text-3xl font-bold">4. DV Engine (Data View)</h2>
    <p class="text-sm text-slate-300">
      DV is a global "view bag" that lets pages and endpoints push metadata into layouts and components without
      passing parameters manually.
    </p>

    <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-4 text-xs text-slate-300">
      <strong>Core methods:</strong>
      <ul class="list-disc list-inside mt-2 text-slate-400 space-y-1">
        <li><code>DV::set(string $key, mixed $value)</code> â€“ store a value accessible in layouts and components.</li>
        <li><code>DV::get(string $key, mixed $default = null)</code> â€“ get a value; fallback if not set.</li>
      </ul>
    </div>

    <h3 class="text-lg font-semibold">4.1 Title handling</h3>
    <p class="text-sm text-slate-300">
      The recommended way to define the document title for a route is:
    </p>

    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
&lt;?php
// In any page.php
use App\Core\DV;

DV::set('title', 'Admin Â· Users');

// In layout.php
$title = DV::get('title', $GLOBALS['title'] ?? 'Bastion PHP');
?&gt;
&lt;title&gt;&lt;?= e($title) ?&gt;&lt;/title&gt;
    </pre>

    <p class="text-xs text-slate-500">
      Also supported: <code>$GLOBALS['title'] = '...';</code> as a legacy fallback. DV always takes precedence if defined.
    </p>
  </section>

  <!-- 5. Request / Response / Validation -->
  <section id="request-response" class="space-y-4">
    <h2 class="text-3xl font-bold">5. Request, Response &amp; Validation</h2>

    <h3 class="text-xl font-semibold">5.1 Request</h3>
    <p class="text-sm text-slate-300">
      The <code>Request</code> class wraps all input sources:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>$req->method</code>, <code>$req->path</code>, <code>$req->headers</code></li>
      <li><code>$req->query</code>, <code>$req->body</code>, <code>$req->cookies</code>, <code>$req->files</code></li>
      <li><code>$req->meta</code> â€“ extra information: route params, CSP nonce, user, etc.</li>
    </ul>

    <p class="text-sm text-slate-300">
      Helpers:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>$req->input('key')</code> â€“ search in body and query.</li>
      <li><code>$req->isJson()</code> â€“ true if incoming body is JSON.</li>
      <li><code>$req->json()</code> â€“ decoded JSON body.</li>
      <li><code>$req->validate(array $rules)</code> â€“ validates input and either returns data or throws <code>ValidationException</code>.</li>
    </ul>

    <h3 class="text-xl font-semibold">5.2 Response</h3>
    <p class="text-sm text-slate-300">
      The <code>Response</code> helper standardizes output:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>Response::json($data, int $status = 200)</code> â€“ sets JSON header and exits.</li>
      <li><code>Response::html($html, int $status = 200)</code> â€“ sends raw HTML and exits.</li>
      <li><code>Response::redirect(string $url, int $status = 302)</code> â€“ safe redirect with Location header.</li>
      <li><code>Response::abort(int $status, string $message = '')</code> â€“ abort with error view if available (404/500).</li>
    </ul>
  </section>

  <!-- 6. Database & QueryBuilder -->
  <section id="db" class="space-y-4">
    <h2 class="text-3xl font-bold">6. Database &amp; QueryBuilder</h2>
    <p class="text-sm text-slate-300">
      Bastion uses PDO with a QueryBuilder-like facade via <code>DB::table()</code>. SQLite is default and configured with WAL mode.
    </p>

    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
$admins = DB::table('users')
  ->where('role', 'admin')
  ->orderBy('id', 'DESC')
  ->limit(20)
  ->get();

$user = DB::table('users')
  ->where('id', 1)
  ->first();

$id = DB::table('users')->insert([
  'name' => 'New User',
  'email' => 'new@example.com',
  'password' => password_hash('secret123', PASSWORD_DEFAULT),
  'role' => 'user',
  'created_at' => time(),
]);

DB::table('users')
  ->where('id', $id)
  ->update(['role' => 'admin']);

DB::table('users')
  ->where('id', $id)
  ->delete();
    </pre>

    <p class="text-xs text-slate-500">
      Always escape values with <code>e()</code> when printing to HTML. JSON responses don't need escaping, but your UI does.
    </p>
  </section>

  <!-- 7. Components (Server & Client) -->
  <section id="components" class="space-y-6">
    <h2 class="text-3xl font-bold">7. Components (Server &amp; Client-Interactive)</h2>

    <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-4 text-sm text-slate-300">
      <strong>Two types of components:</strong>
      <ul class="list-disc list-inside mt-2 text-slate-400 space-y-1">
        <li><strong>Server-side components</strong>: Pure PHP functions that return HTML strings. No HTMX, no JavaScript.</li>
        <li><strong>Client-interactive components</strong>: Same as server components, but include <code>hx-*</code> attributes so HTMX can update the DOM.</li>
      </ul>
    </div>

    <h3 class="text-xl font-semibold">7.1 Server-side component example</h3>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
&lt;?php
// resources/views/components/UserCard.php
function UserCard(array $user): string {
  return "
  &lt;article class='p-4 sm:p-6 rounded-2xl shadow-xl border border-slate-700'&gt;
    &lt;h3 class='text-lg font-bold'&gt;".e($user['name'])."&lt;/h3&gt;
    &lt;p class='text-sm opacity-80'&gt;".e($user['email'])."&lt;/p&gt;
  &lt;/article&gt;";
}
    </pre>

    <h3 class="text-xl font-semibold">7.2 Client-interactive component example (HTMX)</h3>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
&lt;?php
// resources/views/components/UserRow.php
function UserRow(array $user): string {
  $id = (int) $user['id'];
  return "
  &lt;tr id='user-{$id}' class='border-b border-slate-800'&gt;
    &lt;td class='py-2'&gt;".e($user['name'])."&lt;/td&gt;
    &lt;td class='py-2'&gt;".e($user['email'])."&lt;/td&gt;
    &lt;td&gt;
      &lt;button
        hx-delete='/api/users/{$id}'
        hx-target='#user-{$id}'
        hx-swap='outerHTML'
        class='px-2 py-1 bg-red-500/10 text-red-400 border border-red-500/40 rounded-md hover:bg-red-500/20'
      &gt;
        Delete
      &lt;/button&gt;
    &lt;/td&gt;
  &lt;/tr&gt;";
}
    </pre>
  </section>

  <!-- 8. Routing & Layouts -->
  <section id="routing" class="space-y-4">
    <h2 class="text-3xl font-bold">8. Routing &amp; Layouts</h2>
    <p class="text-sm text-slate-300">
      Router is file-based and collects layouts from root to leaf:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>app/layout.php</code> â€“ always applied as the outermost layout.</li>
      <li><code>app/admin/layout.php</code> â€“ added for any route under <code>/admin</code>.</li>
      <li><code>app/admin/users/layout.php</code> â€“ added for <code>/admin/users</code>.</li>
      <li>The final <code>page.php</code> or <code>+server.php</code> is the leaf.</li>
    </ul>

    <p class="text-sm text-slate-300">
      Dynamic parameters use <code>[param]</code> folders: <code>/api/users/5</code> â†’ <code>app/api/users/[id]/+server.php</code> and <code>$req->meta['params']['id'] = "5"</code>.
    </p>
  </section>

  <!-- 9. Middleware & Security -->
  <section id="middleware-security" class="space-y-4">
    <h2 class="text-3xl font-bold">9. Middleware &amp; Security</h2>
    <p class="text-sm text-slate-300">
      Requests flow through this pipeline:
    </p>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
SecurityHeaders â†’ RateLimit â†’ AuthMiddleware â†’ Router â†’ (page or +server.php handler)
    </pre>

    <h3 class="text-xl font-semibold">9.1 SecurityHeaders</h3>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li>Generates a random CSP nonce: <code>$req->meta['csp_nonce']</code>.</li>
      <li>Builds a <code>Content-Security-Policy</code> that only allows scripts/styles with that nonce, plus allowed CDNs.</li>
      <li>Sets <code>X-Frame-Options</code>, <code>X-Content-Type-Options</code>, <code>Referrer-Policy</code>.</li>
    </ul>

    <h3 class="text-xl font-semibold">9.2 CSRF &amp; AuthMiddleware</h3>
    <p class="text-sm text-slate-300">
      <code>AuthMiddleware</code> glues auth and CSRF:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li>Decodes the JWT from cookies/headers and injects <code>$req->meta['user']</code> and <code>$GLOBALS['auth_user']</code>.</li>
      <li>On POST/PUT/PATCH/DELETE, if <code>CSRF_ENABLED=true</code>, calls <code>CSRF::handle()</code> to compare tokens.</li>
    </ul>

    <p class="text-sm text-slate-300">
      Forms use:
    </p>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
&lt;form method="POST" action="/some-endpoint"&gt;
  &lt;?= csrf_field() ?&gt;
  ...
&lt;/form&gt;
    </pre>

    <p class="text-xs text-slate-500">
      <code>csrf_field()</code> prints a hidden input with the session CSRF token. For HTMX/JSON clients, you can send the token in headers.
    </p>
  </section>

  <!-- 10. Auth & User model -->
  <section id="auth" class="space-y-4">
    <h2 class="text-3xl font-bold">10. Authentication &amp; User Model</h2>
    <p class="text-sm text-slate-300">
      Auth is built around:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><strong>User model</strong> (static methods) for DB operations.</li>
      <li><strong>JWT access token</strong> in cookie or header.</li>
      <li><strong>Refresh tokens</strong> stored in DB for rotation.</li>
    </ul>

    <p class="text-sm text-slate-300">
      Helper:
    </p>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
$user = auth();  // returns current user array or null
if ($user && $user['role'] === 'admin') {
  // admin logic
}
    </pre>
  </section>

  <!-- 11. Migrations & Seeds -->
  <section id="migrations" class="space-y-4">
    <h2 class="text-3xl font-bold">11. Migrations &amp; Seeds</h2>

    <h3 class="text-xl font-semibold">11.1 Migrations</h3>
    <p class="text-sm text-slate-300">
      Migrations are plain SQL:
    </p>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
-- database/migrations/001_create_users.sql
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  email TEXT NOT NULL UNIQUE,
  password TEXT NOT NULL,
  role TEXT NOT NULL DEFAULT 'user',
  created_at INTEGER NOT NULL
);
    </pre>

    <p class="text-xs text-slate-500">
      Run migrations with <code>./bastion migrate</code>.
    </p>

    <h3 class="text-xl font-semibold">11.2 Seeds</h3>
    <pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
&lt;?php
// database/seeds/UsersSeeder.php
use App\Core\DB;

$pdo = DB::getPdo();
$count = (int) $pdo->query("SELECT COUNT(*) FROM users")->fetchColumn();

if ($count === 0) {
  $stmt = $pdo->prepare(
    "INSERT INTO users (name,email,password,role,created_at) VALUES (?,?,?,?,?)"
  );
  $stmt->execute([
    'Admin',
    'admin@example.com',
    password_hash('admin123', PASSWORD_DEFAULT),
    'admin',
    time(),
  ]);
}
    </pre>
  </section>

  <!-- 12. CLI -->
  <section id="cli" class="space-y-4">
    <h2 class="text-3xl font-bold">12. CLI (bastion)</h2>
    <p class="text-sm text-slate-300">
      The <code>bastion</code> script is your dev tool:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>./bastion run-dev</code> â€“ run PHP built-in server on 127.0.0.1:8000.</li>
      <li><code>./bastion migrate</code> â€“ execute all migrations.</li>
      <li><code>./bastion seed</code> â€“ run all seeders.</li>
      <li><code>./bastion key:generate</code> â€“ generate APP_KEY.</li>
      <li><code>./bastion jwt:secret</code> â€“ generate JWT_SECRET.</li>
      <!-- Future make:* commands can be added to the same script -->
    </ul>
  </section>

  <!-- 13. Docs Routing Wizard -->
  <section id="routing-wizard" class="space-y-4">
    <h2 class="text-3xl font-bold">13. Docs Routing Wizard</h2>
    <p class="text-sm text-slate-300">
      This wizard simulates how Bastion PHP resolves a given path to:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li>Detect if it's a page or API route.</li>
      <li>Show the resolved file path (<code>page.php</code> or <code>+server.php</code>).</li>
      <li>List the stack of layouts from root to leaf.</li>
      <li>Show which dynamic parameters are extracted.</li>
    </ul>

    <div class="bg-slate-950 border border-slate-800 rounded-xl p-4 shadow-xl space-y-3">
      <input
        id="routeInput"
        type="text"
        class="w-full bg-slate-900 border border-slate-700 rounded-xl p-2 text-sm text-slate-200 placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none"
        placeholder="/admin/users or /api/users/5"
      >
      <button
        id="resolveBtn"
        class="px-4 py-2 bg-cyan-500/10 border border-cyan-500/40 text-cyan-300 rounded-xl hover:bg-cyan-500/20 text-sm"
      >
        Resolve Route
      </button>
      <div id="wizardResult" class="text-xs sm:text-sm text-slate-300 space-y-2"></div>
    </div>
  </section>

  <!-- 14. Responsive Tailwind Tips -->
  <section id="responsive" class="space-y-4">
    <h2 class="text-3xl font-bold">14. Responsive UI with Tailwind CDN</h2>
    <p class="text-sm text-slate-300">
      Because Tailwind is loaded via CDN in this docs layout, you can copy/paste these classes into your pages:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>grid sm:grid-cols-2 lg:grid-cols-3</code> â€“ responsive card grid.</li>
      <li><code>p-4 sm:p-6</code> â€“ padding that increases on larger screens.</li>
      <li><code>rounded-2xl shadow-xl</code> â€“ cards with nice rounded corners and shadow.</li>
      <li><code>bg-slate-900/80 border border-slate-800</code> â€“ dark panels similar to this docs style.</li>
    </ul>
  </section>

  <!-- 15. Deployment Mindset -->
  <section id="deployment" class="space-y-4 pb-12">
    <h2 class="text-3xl font-bold">15. Deployment Mindset</h2>
    <p class="text-sm text-slate-300">
      For actual deployment, you typically:
    </p>
    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li>Point Nginx/Apache to <code>public/index.php</code>.</li>
      <li>Set <code>APP_ENV=production</code> and disable <code>APP_DEBUG</code>.</li>
      <li>Rotate <code>APP_KEY</code> and <code>JWT_SECRET</code> when needed using CLI.</li>
      <li>Optionally remove Tailwind CDN from app layout and use built CSS + <code>fallback.css</code> for styling.</li>
    </ul>
  </section>

</main>

<footer class="border-t border-slate-800 py-4 text-center text-xs text-slate-500">
  Bastion PHP 0.1.0 Â· Secure internal tooling framework Â· Pure PHP, no frontend framework required
</footer>

<!-- Docs Routing Wizard Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const input = document.getElementById('routeInput');
  const btn = document.getElementById('resolveBtn');
  const result = document.getElementById('wizardResult');

  function resolveRoute() {
    const raw = (input.value || '').trim();
    const path = raw.replace(/^\/+/, ''); // remove leading slash
    const segments = path === '' ? [] : path.split('/').filter(Boolean);

    let type = 'Page';
    let file;
    let layouts = ['app/layout.php'];
    let params = {};

    if (segments.length === 0) {
      file = 'app/page.php';
    } else if (segments[0] === 'api') {
      type = 'API';
      const resource = segments[1] || '';
      if (segments.length === 2) {
        file = `app/api/${resource}/+server.php`;
      } else if (segments.length >= 3) {
        const param = segments[2];
        params['id'] = param;
        file = `app/api/${resource}/[id]/+server.php`;
      } else {
        file = 'app/api/+server.php';
      }
    } else {
      file = `app/${path}/page.php`;
    }

    // collect layouts (skip "api")
    let walker = 'app';
    for (const seg of segments) {
      if (seg === 'api') continue;
      walker += '/' + seg;
      layouts.push(`${walker}/layout.php`);
    }
    layouts = Array.from(new Set(layouts)); // unique

    let html = `
      <p>ðŸŽ¯ <strong>Type:</strong> ${type}</p>
      <p>ðŸ“„ <strong>Resolved file:</strong> <code>${file}</code></p>
      <p>ðŸ§± <strong>Layout stack (root â†’ leaf):</strong></p>
      <ul class="list-disc list-inside text-slate-400">
        ${layouts.map(l => `<li><code>${l}</code></li>`).join('')}
      </ul>
    `;

    const paramKeys = Object.keys(params);
    if (paramKeys.length) {
      html += `<p>ðŸ”‘ <strong>Route params:</strong></p><ul class="list-disc list-inside text-slate-400">`;
      for (const k of paramKeys) {
        html += `<li><code>$req->meta['params']['${k}']</code> = "<strong>${params[k]}</strong>"</li>`;
      }
      html += `</ul>`;
    } else {
      html += `<p class="text-slate-500">No dynamic parameters detected for this route.</p>`;
    }

    result.innerHTML = html;
  }

  btn.addEventListener('click', resolveRoute);
});
</script>

</body>
</html>