<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <title>Bastion Enterprise v1.0.0 | The Definitive Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Comprehensive documentation for Bastion Enterprise. The Monolith Modular PHP Framework designed for high-security internal tools.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
    /* * ==========================================================================
     * BASTION DESIGN SYSTEM (Enterprise Dark)
     * ==========================================================================
     */
    :root {
      /* --- Color Palette: Deep Space --- */
      --bg-root: #020617;       /* Slate 950 */
      --bg-sidebar: #0f172a;    /* Slate 900 */
      --bg-card: #1e293b;       /* Slate 800 */
      --bg-surface: #334155;    /* Slate 700 */
      
      /* --- Borders --- */
      --border-dim: rgba(148, 163, 184, 0.1);
      --border-mid: rgba(148, 163, 184, 0.2);
      
      /* --- Text --- */
      --text-main: #f8fafc;     /* Slate 50 */
      --text-muted: #94a3b8;    /* Slate 400 */
      --text-dim: #64748b;      /* Slate 500 */
      
      /* --- Brand Colors --- */
      --primary: #0ea5e9;       /* Sky 500 */
      --primary-light: #38bdf8; /* Sky 400 */
      --primary-glow: rgba(14, 165, 233, 0.15);
      
      --secondary: #6366f1;     /* Indigo 500 */
      
      /* --- Syntax Highlighting --- */
      --tok-keyword: #c084fc;   /* Purple */
      --tok-function: #38bdf8;  /* Sky */
      --tok-string: #4ade80;    /* Green */
      --tok-class: #fbbf24;     /* Amber */
      --tok-comment: #64748b;   /* Slate */
      --tok-variable: #f87171;  /* Red */
      --tok-bg: #0B1120;

      /* --- Dimensions --- */
      --sidebar-width: 280px;
    }

    /* --- Base --- */
    *, *::before, *::after { box-sizing: border-box; }
    
    html { scroll-behavior: smooth; scroll-padding-top: 100px; }
    
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg-root);
      color: var(--text-main);
      line-height: 1.7;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
    }

    /* --- Typography --- */
    h1, h2, h3, h4 { color: #fff; font-weight: 700; margin: 0 0 1rem 0; letter-spacing: -0.02em; }
    
    h1 { 
      font-size: 3.5rem; 
      line-height: 1.1; 
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    h2 { 
      font-size: 2rem; 
      margin-top: 4rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-dim);
      display: flex; align-items: center;
    }
    h2::before { content: '#'; color: var(--primary); margin-right: 0.5rem; opacity: 0.5; font-size: 0.8em; }
    
    h3 { font-size: 1.5rem; margin-top: 2.5rem; color: var(--text-main); }
    h4 { font-size: 1.1rem; margin-top: 2rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    
    p { margin-bottom: 1.5rem; color: var(--text-muted); max-width: 75ch; }
    
    a { color: var(--primary-light); text-decoration: none; border-bottom: 1px solid transparent; transition: 0.2s; }
    a:hover { border-bottom-color: var(--primary-light); color: #fff; }
    
    ul, ol { margin-bottom: 2rem; color: var(--text-muted); padding-left: 1.5rem; }
    li { margin-bottom: 0.5rem; }
    
    hr { border: 0; border-top: 1px solid var(--border-dim); margin: 3rem 0; }

    /* --- Layout --- */
    .layout { display: flex; min-height: 100vh; }
    
    /* --- Sidebar --- */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border-dim);
      position: fixed; top: 0; bottom: 0; left: 0;
      z-index: 50; overflow-y: auto;
    }
    
    .sidebar-header {
      padding: 1.5rem; position: sticky; top: 0;
      background: var(--bg-sidebar);
      border-bottom: 1px solid var(--border-dim);
      z-index: 10; backdrop-filter: blur(10px);
    }
    
    .logo {
      display: flex; align-items: center; gap: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 800; font-size: 1.25rem; color: #fff;
    }
    .logo-box {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 6px; display: grid; place-items: center;
      box-shadow: 0 0 20px var(--primary-glow);
    }
    
    .nav-content { padding: 1.5rem 0; }
    .nav-group { margin-bottom: 2rem; }
    .nav-title {
      padding: 0 1.5rem; font-size: 0.7rem; text-transform: uppercase;
      letter-spacing: 0.1em; color: var(--text-dim); font-weight: 700; margin-bottom: 0.75rem;
    }
    .nav-link {
      display: block; padding: 0.5rem 1.5rem; font-size: 0.9rem;
      color: var(--text-muted); border-left: 2px solid transparent; transition: all 0.2s;
    }
    .nav-link:hover { color: #fff; background: rgba(255,255,255,0.03); }
    .nav-link.active {
      color: var(--primary-light); border-left-color: var(--primary-light);
      background: linear-gradient(90deg, var(--primary-glow) 0%, transparent 100%);
      font-weight: 500;
    }

    /* --- Main Content --- */
    .main { margin-left: var(--sidebar-width); flex: 1; padding: 4rem 5rem; max-width: 100%; }
    .container { max-width: 1000px; margin: 0 auto; }

    /* --- Components --- */
    .alert {
      background: var(--bg-card); border: 1px solid var(--border-mid);
      border-left: 4px solid var(--primary); border-radius: 0.5rem;
      padding: 1.5rem; margin: 2rem 0;
    }
    .alert-info { border-left-color: var(--primary); background: linear-gradient(to right, rgba(14, 165, 233, 0.05), transparent); }
    .alert-warn { border-left-color: #f59e0b; background: linear-gradient(to right, rgba(245, 158, 11, 0.05), transparent); }
    
    pre {
      background: var(--tok-bg); border: 1px solid var(--border-dim);
      border-radius: 0.75rem; padding: 1.5rem; overflow-x: auto;
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; line-height: 1.7;
      margin: 1.5rem 0 2.5rem; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
    }
    code { font-family: 'JetBrains Mono', monospace; }
    :not(pre) > code {
      background: rgba(255,255,255,0.05); color: var(--primary-light);
      padding: 0.2em 0.4em; border-radius: 0.25em; font-size: 0.9em;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin: 3rem 0; }
    .feature-card {
      background: var(--bg-card); border: 1px solid var(--border-dim);
      border-radius: 1rem; padding: 2rem; transition: 0.3s;
    }
    .feature-card:hover { border-color: var(--primary); transform: translateY(-5px); }
    .fc-icon { font-size: 2rem; margin-bottom: 1rem; }
    .fc-title { font-size: 1.25rem; font-weight: 700; color: #fff; margin-bottom: 0.5rem; }

    /* File Tree */
    .tree { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: var(--text-muted); }
    .tree-item { display: flex; align-items: center; padding: 0.1rem 0; }
    .tree-icon { margin-right: 0.75rem; color: var(--text-dim); }
    .tree-hl { color: var(--primary-light); font-weight: bold; }
    
    /* Tables */
    .table-wrapper { border: 1px solid var(--border-dim); border-radius: 0.75rem; overflow: hidden; margin: 2rem 0; }
    table { width: 100%; border-collapse: collapse; background: var(--bg-card); font-size: 0.9rem; }
    th { background: var(--bg-sidebar); padding: 1rem 1.5rem; text-align: left; color: var(--text-main); border-bottom: 1px solid var(--border-mid); }
    td { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-dim); color: var(--text-muted); }
    tr:last-child td { border-bottom: none; }
  </style>
</head>
<body>

<div class="layout">
  
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-box">B</div>
        <span>BASTION <small style="color:var(--text-dim); font-weight:400;">ENT.</small></span>
      </div>
    </div>
    
    <div class="nav-content">
      <div class="nav-group">
        <div class="nav-title">Preface</div>
        <a href="#intro" class="nav-link">Introduction</a>
        <a href="#philosophy" class="nav-link">The Monolith Philosophy</a>
        <a href="#getting-started" class="nav-link">Getting Started</a>
        <a href="#structure" class="nav-link">Directory Structure</a>
      </div>

      <div class="nav-group">
        <div class="nav-title">Architecture Core</div>
        <a href="#ioc" class="nav-link">IoC Container</a>
        <a href="#providers" class="nav-link">Service Providers</a>
        <a href="#config" class="nav-link">Configuration</a>
<a href="#helpers" class="nav-link">Helpers Reference</a>
        <a href="#facades" class="nav-link">Global Helpers</a>
      </div>

      <div class="nav-group">
        <div class="nav-title">Routing & Logic</div>
        <a href="#hybrid-routing" class="nav-link">Hybrid Routing</a>
        <a href="#api-endpoints" class="nav-link">API (+server.php)</a>
        <a href="#ui-pages" class="nav-link">UI Pages (page.php)</a>
<a href="#layouts" class="nav-link"> Layouts (layout.php)</a>
        <a href="#middleware" class="nav-link">Middleware</a>
      </div>

      <div class="nav-group">
        <div class="nav-title">State Management</div>
        <a href="#dv-engine" class="nav-link" style="color:var(--primary-light)">The DV Engine</a>
        <a href="#session" class="nav-link">Session & Flash</a>
      </div>

      <div class="nav-group">
        <div class="nav-title">Data Layer</div>
        <a href="#database" class="nav-link">Database & Config</a>
        <a href="#query-builder" class="nav-link">Query Builder</a>
        <a href="#orm" class="nav-link">Models (ORM)</a>
        <a href="#migrations" class="nav-link">Migrations</a>
      </div>

      <div class="nav-group">
        <div class="nav-title">Frontend</div>
        <a href="#tailwind" class="nav-link">Tailwind v4 (Native)</a>
        <a href="#components" class="nav-link">Functional Components</a>
        <a href="#htmx" class="nav-link">HTMX Integration</a>
      </div>
      
      <div class="nav-group">
        <div class="nav-title">Security & Ops</div>
        <a href="#security" class="nav-link">Security Protocols</a>
        <a href="#cli" class="nav-link">Bastion CLI</a>
        <a href="#deployment" class="nav-link">Deployment</a>
      </div>
    </div>
  </aside>

  <main class="main">
    <div class="container">

      <section id="intro" class="mb-24">
        <div style="display:inline-block; padding: 4px 12px; border-radius: 20px; background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.2); color: var(--primary-light); font-size: 0.75rem; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: 0.05em;">
          ENTERPRISE RELEASE v1.0.0
        </div>
        <h1>The Fortress for your<br>Internal Tools.</h1>
        <p class="text-lg">
          Bastion Enterprise is a <strong>Monolith Modular</strong> framework designed to standardize PHP development. 
          It bridges the gap between the Developer Experience of modern meta-frameworks (like Next.js) and the raw stability of Enterprise PHP.
        </p>

        <div class="feature-grid">
          <div class="feature-card">
            <div class="fc-icon">üè∞</div>
            <h3>Monolith Modular</h3>
            <p>You own the core. The entire framework lives in <code>app/core</code>, not hidden in <code>vendor</code>. Complete transparency.</p>
          </div>
          <div class="feature-card">
            <div class="fc-icon">‚ö°</div>
            <h3>Hybrid Routing</h3>
            <p>Unified file-based routing supporting both <strong>UI Pages</strong> (page.php) and <strong>Typed API Endpoints</strong> (+server.php).</p>
          </div>
          <div class="feature-card">
            <div class="fc-icon">üé®</div>
            <h3>Tailwind v4 Native</h3>
            <p>Built for the future. Zero configuration JavaScript. Bastion uses the new <strong>CSS-First</strong> architecture of Tailwind v4.</p>
          </div>
<div class="feature-card">
  <div class="fc-icon">üõ°Ô∏è</div>
  <h3>Secure Rendering by Default</h3>
  <p>
    Bastion ships with a <strong>security-first view layer</strong>: hardened HTTP
    headers, CSRF protection, CSP nonces, and an <code>e()</code> escape helper wired
    into the <strong>DV (Data View)</strong> engine. Dynamic data is passed through DV
    and escaped with <code>e()</code> before hitting the template, keeping untrusted
    content out of your HTML by default.
  </p>
</div>
        </div>
      </section>

      <hr />

      <section id="philosophy">
        <h2>Philosophy & Architecture</h2>
        <p>
          Modern PHP frameworks have become black boxes. They rely heavily on "magic" hidden deep within composer packages. 
          When something breaks, you're debugging vendor code.
        </p>
        <p>
          <strong>Bastion takes a different approach:</strong> The Framework <em>is</em> your application. 
          When you install Bastion, we scaffold the <strong>Kernel</strong>, the <strong>Router</strong>, and the <strong>Container</strong> directly into your project's <code>app/core/</code> directory.
        </p>
        
        <div class="alert alert-info">
          <span class="alert-title">‚ìò The "Battery Pack" Concept</span>
          Bastion relies on Composer only for low-level utilities (DotEnv, PHP-JWT). 
          High-level logic (Routing, ORM, Auth) is implemented as <strong>First-Party Code</strong> within your <code>app/core</code> directory. 
          You can modify the core to suit your enterprise needs without waiting for upstream PRs.
        </div>
      </section>

      <section id="getting-started">
        <h2>Getting Started</h2>
        <p>Bastion provides a self-contained installer script that sets up the entire environment.</p>

        <h3>Prerequisites</h3>
        <ul>
          <li><strong>PHP 8.1+</strong> (Extensions: PDO, OpenSSL, Mbstring, JSON)</li>
          <li><strong>Composer</strong> (For dependency management)</li>
          <li><strong>Node.js 18+</strong> (For Tailwind CSS v4 compilation)</li>
        </ul>

        <h3>Installation</h3>
        <pre><code class="language-bash"><span style="color:var(--text-dim)"># 1. Download Installer</span>
curl -O https://bastion-framework.com/install-bastion.sh

<span style="color:var(--text-dim)"># 2. Run Installer</span>
bash install-bastion.sh my-project

<span style="color:var(--text-dim)"># 3. Enter Fortress</span>
cd my-project

<span style="color:var(--text-dim)"># 4. Ignite</span>
php bastion serve</code></pre>
<h3>Quickstart: Roles & Enterprise Employee Module</h3>
        <p>
          This example shows how to use Bastion‚Äôs boilerplate to build a real 
          internal tool: an <strong>Employee Directory</strong> with roles 
          <code>admin</code>, <code>supervisor</code> and <code>employee</code>. 
          It combines:
        </p>
        <ul>
          <li>Layouts (<code>app/views/layouts/app.php</code>)</li>
          <li>Components (<code>component('Forms.Input')</code>, <code>component('Forms.Button')</code>, etc.)</li>
          <li>Helpers (<code>Auth</code>, <code>DV</code>, <code>DB</code>, <code>csrf_field()</code>, <code>request()</code>, <code>response()</code>)</li>
          <li>API endpoints with file-based routing (<code>app/api/employees/+server.php</code>)</li>
          <li>A page using the layout to render a complete screen (<code>app/admin/employees/page.php</code>)</li>
        </ul>

        <div class="alert alert-info">
          <span class="alert-title">Mental model</span>
          Every business feature in Bastion is usually:
          <strong>Model + Migration + Queries + Endpoint + Page + Layout + Components</strong>.
          Same pattern, different table and different screen.
        </div>

        <h4>1. Roles: admin, supervisor, employee</h4>
        <p>
          Bastion‚Äôs user table already has a <code>role</code> column. A very simple 
          enterprise setup is:
        </p>
        <ul>
          <li><code>admin</code>: full access to all modules and user management.</li>
          <li><code>supervisor</code>: can view and manage employees inside specific modules.</li>
          <li><code>employee</code>: can only see their own data or limited dashboards.</li>
        </ul>

        <p>
          You can enforce these roles at the top of a page using the <code>Auth</code> helper:
        </p>

        <pre><code class="language-php">&lt;?php
// File: app/admin/employees/page.php

use App\Core\Auth;
use App\Core\DV;
use App\Core\Http\Response;
use App\Core\Database\DB;

// Only allow access to admins and supervisors.
if (!Auth::check() || !in_array(Auth::user()['role'], ['admin', 'supervisor'])) {
    return Response::redirect('/login');
}

// Set the page title that the layout will read.
DV::set('title', 'Employees Directory');

// Read an optional search term from the query string: ?q=john
$search = request()->get('q', '');

// Build a query using the DB helper and the query builder.
$employeesQuery = DB::table('employees')
    ->where('status', '=', 'active')
    ->whereIn('role', ['employee', 'supervisor'])
    ->orderBy('created_at', 'desc');

// If the user typed a search term, filter by name or email.
if ($search !== '') {
    $employeesQuery
        ->where(function ($q) use ($search) {
            $q->where('name', 'LIKE', '%' . $search . '%')
              ->orWhere('email', 'LIKE', '%' . $search . '%');
        });
}

// Only show the first 50 results (pagination can be added later).
$employees = $employeesQuery
    ->limit(50)
    ->offset(0)
    ->get();

// Prepare table data for a reusable component.
$headers = ['Name', 'Email', 'Role', 'Position', 'Department'];
$rows = array_map(function ($e) {
    return [
        $e['name'],
        $e['email'],
        ucfirst($e['role']),
        $e['position'],
        $e['department'] ?? '-',
    ];
}, $employees);

// Render a reusable table component.
$table = component('Data.Table', [
    'headers' =&gt; $headers,
    'rows'    =&gt; $rows,
]);
?&gt;

&lt;section class="space-y-6"&gt;
  &lt;header class="flex items-center justify-between gap-4"&gt;
    &lt;div&gt;
      &lt;h1 class="text-2xl font-bold"&gt;Employees&lt;/h1&gt;
      &lt;p class="text-sm text-slate-400"&gt;
        Admins &amp; supervisors can manage all active employees.
      &lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="flex items-center gap-3"&gt;
      &lt;form method="GET" class="flex items-center gap-2"&gt;
        &lt;input 
          type="text"
          name="q"
          value="&lt;?= htmlspecialchars($search) ?&gt;"
          placeholder="Search by name or email..."
          class="rounded-md bg-slate-900 border border-slate-700 px-3 py-1.5 text-sm"
        /&gt;
        &lt;button type="submit" class="text-sm px-3 py-1.5 rounded-md bg-slate-800 border border-slate-700"&gt;
          Search
        &lt;/button&gt;
      &lt;/form&gt;

      &lt;?= component('Forms.Button', [
        'text' =&gt; 'New Employee',
        'href' =&gt; '/admin/employees/create',
        'variant' =&gt; 'primary',
      ]) ?&gt;
    &lt;/div&gt;
  &lt;/header&gt;

  &lt;?= $table ?&gt;
&lt;/section&gt;
</code></pre>

        <div class="syntax-explanation">
          <h5>Syntax Explanation (page.php)</h5>
          <ul>
            <li>
              <code>&lt;?php ... ?&gt;</code> opens and closes PHP code. 
              Anything inside runs on the server before the HTML is sent.
            </li>
            <li>
              <code>use App\Core\Auth;</code> and similar lines import Bastion classes. 
              <strong>Do not rename</strong> the parts like <code>App\Core\Auth</code> 
              unless you know what you are doing.
            </li>
            <li>
              <code>Auth::check()</code> and <code>Auth::user()</code> are 
              <strong>Bastion helpers</strong> to read the logged-in user. 
              These names are <strong>fixed API</strong>, not examples.
            </li>
            <li>
              <code>if (...)</code>, <code>return</code>, <code>function</code>, 
              <code>use</code>, <code>class</code> are PHP <strong>keywords</strong>. 
              They cannot be changed.
            </li>
            <li>
              Names like <code>$employeesQuery</code>, <code>$headers</code>, 
              <code>$rows</code>, <code>$search</code> are 
              <strong>your own variable names</strong>. You can rename them
              as long as you change them consistently everywhere in the file.
            </li>
            <li>
              <code>DB::table('employees')</code> means ‚Äústart a query on the 
              <code>employees</code> table‚Äù. The <code>DB</code> and 
              <code>table</code> words are part of Bastion‚Äôs database API 
              (fixed), but the string <code>'employees'</code> is the table 
              name in your database (you can change it if your table is called 
              something else and your migration matches it).
            </li>
            <li>
              The arrow <code>-&gt;</code> means ‚Äúcall a method on the thing 
              before the arrow‚Äù. Example:
              <code>$employeesQuery-&gt;where(...)</code> = ‚Äútake the query and 
              add a WHERE clause‚Äù.
            </li>
            <li>
              Common query builder methods in this example:
              <ul>
                <li><code>where('column', '=', 'value')</code></li>
                <li><code>whereIn('column', ['a','b'])</code></li>
                <li><code>orWhere(...)</code> inside a closure</li>
                <li><code>orderBy('column', 'desc')</code></li>
                <li><code>limit(50)</code> and <code>offset(0)</code></li>
                <li><code>get()</code> (run the query and return a list of rows)</li>
              </ul>
            </li>
            <li>
              <code>component('Data.Table', ...)</code> is a Bastion view helper 
              that returns a ready-made HTML table. 
              <code>'Data.Table'</code> is a fixed component name; the arrays 
              <code>'headers'</code> and <code>'rows'</code> are your data.
            </li>
          </ul>
        </div>

        <h4>2. Layout: how the page is wrapped</h4>
        <p>
          The layout <code>app/views/layouts/app.php</code> is applied automatically. 
          You usually <strong>do not</strong> include HTML <code>&lt;html&gt;</code> or 
          <code>&lt;body&gt;</code> tags in <code>page.php</code> files. 
          The layout does that for you and injects your content where 
          <code>$content</code> appears.
        </p>

        <pre><code class="language-php">&lt;?php
// File: app/views/layouts/app.php (simplified excerpt)

&lt;!DOCTYPE html&gt;
&lt;html lang="&lt;?= env('APP_LOCALE', 'en') ?&gt;" class="dark h-full"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;meta name="csrf-token" content="&lt;?= csrf_token() ?&gt;"&gt;
  &lt;title&gt;&lt;?= \App\Core\DV::get('title', env('APP_NAME')) ?&gt;&lt;/title&gt;
  &lt;link rel="stylesheet" href="/assets/css/app.css"&gt;
&lt;/head&gt;
&lt;body class="h-full bg-slate-950 text-slate-200"&gt;

  &lt;?= \App\Core\View\View::component('Navigation.Navbar') ?&gt;

  &lt;div class="min-h-full pt-16"&gt;
    &lt;main class="py-10"&gt;
      &lt;div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"&gt;
        &lt;?= $content ?&gt;
      &lt;/div&gt;
    &lt;/main&gt;
  &lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <div class="syntax-explanation">
          <h5>Syntax Explanation (layout)</h5>
          <ul>
            <li>
              <code>DV::get('title')</code> reads the title set in 
              <code>page.php</code> (<code>DV::set('title', 'Employees Directory')</code>).
            </li>
            <li>
              <code>$content</code> is a special variable where Bastion injects the 
              rendered content of your current <code>page.php</code>.
            </li>
            <li>
              <code>View::component('Navigation.Navbar')</code> renders a reusable 
              navigation bar component. The string <code>'Navigation.Navbar'</code> 
              is a fixed component name; the component‚Äôs implementation lives under 
              <code>app/components/Navigation/Navbar.php</code>.
            </li>
          </ul>
        </div>

        <h4>3. API endpoint: /api/employees</h4>
        <p>
          The API lives under <code>app/api</code> following file-based routing. 
          The file <code>app/api/employees/+server.php</code> becomes 
          <code>/api/employees</code>.
        </p>

        <pre><code class="language-php">&lt;?php
// File: app/api/employees/+server.php

use App\Core\Http\Request;
use App\Core\Http\Response;
use App\Models\Employee;

return [

    // GET /api/employees
    'get' =&gt; function (Request $request) {
        $search = $request-&gt;get('q', '');

        $query = Employee::query()
            -&gt;where('status', '=', 'active')
            -&gt;whereIn('role', ['employee', 'supervisor'])
            -&gt;orderBy('created_at', 'desc');

        if ($search !== '') {
            $query-&gt;where(function ($q) use ($search) {
                $q-&gt;where('name', 'LIKE', '%' . $search . '%')
                  -&gt;orWhere('email', 'LIKE', '%' . $search . '%');
            });
        }

        $employees = $query-&gt;limit(50)-&gt;offset(0)-&gt;get();

        return Response::json($employees);
    },

    // POST /api/employees
    'post' =&gt; function (Request $request) {
        $data = $request-&gt;validate([
            'name'       =&gt; 'required|string',
            'email'      =&gt; 'required|email',
            'role'       =&gt; 'required|in:employee,supervisor',
            'position'   =&gt; 'required|string',
            'department' =&gt; 'nullable|string',
        ]);

        $employee = Employee::create($data);

        return Response::json($employee, 201);
    },
];
</code></pre>

        <div class="syntax-explanation">
          <h5>Syntax Explanation (API + queries)</h5>
          <ul>
            <li>
              The file returns an <strong>array of HTTP methods</strong>:
              keys like <code>'get'</code> and <code>'post'</code> map to functions
              that handle each HTTP verb.
            </li>
            <li>
              <code>Employee::query()</code> starts a query builder for the 
              <code>employees</code> table through the <code>Employee</code> model.
            </li>
            <li>
              The query builder uses method chaining with <code>-&gt;</code>:
              each call returns the same query object with more conditions.
            </li>
            <li>
              Query builder methods used here:
              <ul>
                <li><code>where('column', '=', 'value')</code> ‚Äì basic filter</li>
                <li><code>whereIn('column', ['a','b'])</code> ‚Äì ‚Äúcolumn is one of these‚Äù</li>
                <li>
                  <code>where(function ($q) { ... })</code> ‚Äì group conditions with 
                  inner <code>where</code> + <code>orWhere</code>
                </li>
                <li><code>orWhere(...)</code> ‚Äì logical OR inside a group</li>
                <li><code>orderBy('created_at', 'desc')</code> ‚Äì sort results</li>
                <li><code>limit(50)</code>, <code>offset(0)</code> ‚Äì pagination controls</li>
                <li><code>get()</code> ‚Äì execute and return an array of rows</li>
              </ul>
            </li>
            <li>
              <code>Response::json($employees)</code> sends a JSON response to the client.
              <code>201</code> is the HTTP status code for ‚ÄúCreated‚Äù.
            </li>
            <li>
              <strong>Fixed names you should not change:</strong>
              <code>Request</code>, <code>Response</code>, <code>Employee::query</code>,
              <code>where</code>, <code>orderBy</code>, <code>limit</code>, 
              <code>offset</code>, <code>get</code>, <code>create</code>.
            </li>
            <li>
              <strong>Example names you can change:</strong>
              <code>Employee</code> (the model, if you create another model), 
              column names like <code>'position'</code>, <code>'department'</code>, 
              and variable names like <code>$query</code>, <code>$employees</code>, 
              <code>$data</code>.
            </li>
          </ul>
        </div>

        <h4>4. Form page: creating employees with components & CSRF</h4>
        <p>
          The ‚ÄúNew Employee‚Äù page shows how to combine forms, components, roles, 
          CSRF protection and HTMX / POST requests.
        </p>

        <pre><code class="language-php">&lt;?php
// File: app/admin/employees/create/page.php

use App\Core\Auth;
use App\Core\DV;
use App\Core\Http\Response;

if (!Auth::check() || !in_array(Auth::user()['role'], ['admin'])) {
    return Response::redirect('/login');
}

DV::set('title', 'Create Employee');

$nameInput = component('Forms.Input', [
    'name'    =&gt; 'name',
    'label'   =&gt; 'Full Name',
    'required' =&gt; true,
]);

$emailInput = component('Forms.Input', [
    'name'    =&gt; 'email',
    'label'   =&gt; 'Email Address',
    'type'    =&gt; 'email',
    'required' =&gt; true,
]);

$roleInput = component('Forms.Select', [
    'name'    =&gt; 'role',
    'label'   =&gt; 'Role',
    'options' =&gt; [
        'employee'   =&gt; 'Employee',
        'supervisor' =&gt; 'Supervisor',
    ],
    'required' =&gt; true,
]);

$positionInput = component('Forms.Input', [
    'name'    =&gt; 'position',
    'label'   =&gt; 'Position',
    'required' =&gt; true,
]);

$departmentInput = component('Forms.Input', [
    'name'    =&gt; 'department',
    'label'   =&gt; 'Department',
    'required' =&gt; false,
]);
?&gt;

&lt;form 
  hx-post="/api/employees"
  hx-target="closest form"
  hx-swap="outerHTML"
  method="post"
  class="space-y-4"
&gt;
  &lt;?= csrf_field() ?&gt;

  &lt;?= $nameInput ?&gt;
  &lt;?= $emailInput ?&gt;
  &lt;?= $roleInput ?&gt;
  &lt;?= $positionInput ?&gt;
  &lt;?= $departmentInput ?&gt;

  &lt;div class="pt-4 flex justify-end"&gt;
    &lt;?= component('Forms.Button', [
      'text'    =&gt; 'Save Employee',
      'type'    =&gt; 'submit',
      'variant' =&gt; 'primary',
    ]) ?&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>

        <div class="syntax-explanation">
          <h5>Syntax Explanation (form + components)</h5>
          <ul>
            <li>
              <code>component('Forms.Input', [...])</code> and 
              <code>component('Forms.Button', [...])</code> call reusable UI components.
              The string (e.g. <code>'Forms.Input'</code>) is the component name 
              (fixed). The array is configuration (you can change labels, names, etc.).
            </li>
            <li>
              <code>csrf_field()</code> prints a hidden input with a CSRF token.
              This is <strong>required for security</strong> on POST requests.
            </li>
            <li>
              <code>hx-post</code>, <code>hx-target</code> and <code>hx-swap</code> are 
              <strong>HTMX attributes</strong> (frontend library) that send the form via 
              AJAX and replace the HTML of the form with the server‚Äôs response.
            </li>
            <li>
              <strong>Fixed names:</strong> <code>component</code>, 
              <code>csrf_field</code>, <code>hx-post</code>, <code>hx-target</code>, 
              <code>hx-swap</code>, HTTP method <code>post</code>.
            </li>
            <li>
              <strong>Example names:</strong> <code>'Create Employee'</code>, 
              input <code>name="department"</code>, placeholder text, button text, etc.
              You can adapt them to any business module (vacations, incidents, payroll, etc.).
            </li>
          </ul>
        </div>

        <div class="alert alert-info">
          <span class="alert-title">Enterprise pattern to remember</span>
          In Bastion, any enterprise tool (employees, roles, vacation requests,
          incident reports, approvals) is built the same way:
          <strong>Role check + DV (page title) + Layout + Components + Queries + API endpoint</strong>.
          Once this loop is clear, junior developers can replicate it for new modules
          without touching the core framework.
        </div>

<section id="quickstart-enterprise-module">
  <h2>Quickstart: Roles, Employees & Enterprise Tools</h2>
  <p>
    When you run the <code>create-bastion-app</code> generator, Bastion does not give you
    a "hello world". It gives you an <strong>opinionated enterprise boilerplate</strong>:
    authentication, layouts, components, database layer, and a dashboard wired with real
    data and security helpers.
  </p>

  <div class="alert alert-info">
    <strong>Goal of this section:</strong> show, step by step, how a non-PHP developer
    can extend the generated boilerplate to support:
    <ul>
      <li>Multiple roles: <code>admin</code>, <code>supervisor</code>, <code>employee</code></li>
      <li>An <strong>Employee CRUD</strong> using the ORM & Query Builder</li>
      <li>A real UI page using <code>layout.php</code>, DV Engine and components</li>
      <li>Typed API endpoints with <code>+server.php</code></li>
    </ul>
  </div>

  <h3>1. What the generator already gives you</h3>
  <p>
    After running <code>./create-bastion-app AcmeTool</code>, you get a fully wired
    application skeleton:
  </p>

  <ul>
    <li><code>app/core/</code> ‚Äì Kernel, Router, IoC Container, DV Engine, Auth, DB, helpers, etc.</li>
    <li><code>app/views/layouts/</code> ‚Äì Base layouts used to wrap all pages.</li>
    <li><code>app/login/page.php</code> and <code>app/login/+server.php</code> ‚Äì Login UI & handler.</li>
    <li><code>app/dashboard/page.php</code> ‚Äì Example internal dashboard that reads from the database.</li>
    <li><code>app/components/</code> ‚Äì Reusable UI components (Cards, Tables, Alerts, Badges‚Ä¶)</li>
    <li><code>database/migrations/</code> ‚Äì Database blueprints (for example, <code>users</code> table).</li>
    <li><code>database/seeds/</code> ‚Äì Seeders that insert demo users (including an admin).</li>
  </ul>

  <div class="alert alert-info">
    <strong>Syntax Explanation (fixed vs. example names)</strong><br>
    In this guide:
    <ul>
      <li>
        <strong>Framework words that you should NOT change</strong>:
        <code>Auth</code>, <code>DV</code>, <code>DB</code>, <code>Response</code>,
        <code>request()</code>, <code>dv()</code>, <code>component()</code>,
        <code>csrf_field()</code>, <code>url()</code>, <code>asset()</code>,
        <code>layout.php</code>, <code>page.php</code>, <code>+server.php</code>.
      </li>
      <li>
        <strong>Business words that are just examples</strong>:
        <code>Employee</code>, <code>VacationRequest</code>, table names like
        <code>employees</code>, route folders like <code>app/employees</code>,
        labels like <code>admin</code>, <code>supervisor</code>, <code>employee</code>.
        These can change depending on your company.
      </li>
    </ul>
  </div>

  <h3>2. Extending roles: admin, supervisor, employee</h3>
  <p>
    By default, the boilerplate seeds users with a simple <code>role</code> field
    (e.g. <code>admin</code> / <code>user</code>). You can extend this to support
    enterprise roles like <code>admin</code>, <code>supervisor</code> and
    <code>employee</code>.
  </p>

  <h4>2.1. Users table (migration)</h4>
  <p>Edit the users migration in <code>database/migrations/...</code> to make the
  intention of roles explicit:</p>

  <pre><code class="language-php">&lt;?php

use App\Core\Database\Schema\Schema;
use App\Core\Database\Schema\Blueprint;

return new class {
    public function up()
    {
        Schema::create('users', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;string('name');
            $table-&gt;string('email')-&gt;unique();
            $table-&gt;string('password');

            // Allowed roles: admin, supervisor, employee
            $table-&gt;string('role')-&gt;nullable();

            $table-&gt;timestamps();
        });
    }

    public function down()
    {
        Schema::drop('users');
    }
};
</code></pre>

  <div class="alert alert-info">
    <strong>Syntax Explanation (Migration)</strong>
    <ul>
      <li><code>$table-&gt;string('name')</code> means "add a VARCHAR column called <code>name</code>".</li>
      <li><code>-&gt;unique()</code> adds a UNIQUE constraint.</li>
      <li><code>&lt;?php</code> is the opening tag for PHP code. It tells the server
        "from here on, we are writing PHP, not plain HTML".</li>
      <li>
        <strong>The part you can change:</strong> column names like <code>'name'</code>,
        <code>'role'</code> are just strings. <br>
        <strong>The part you should not change:</strong> things like
        <code>Schema::create</code>, method names <code>string</code>, <code>timestamps</code>,
        and the <code>$table-&gt;...</code> pattern: that is the Bastion schema API.
      </li>
    </ul>
  </div>

  <h4>2.2. Seeding admin, supervisor and employee</h4>
  <p>In <code>database/seeds/DatabaseSeeder.php</code>, you can insert demo users
  for each role:</p>

  <pre><code class="language-php">&lt;?php

namespace Database\Seeds;

use App\Models\User;

class DatabaseSeeder
{
    public function run()
    {
        // Admin
        User::create([
            'name' =&gt; 'System Administrator',
            'email' =&gt; 'admin@example.com',
            'password' =&gt; password_hash('password', PASSWORD_DEFAULT),
            'role' =&gt; 'admin',
        ]);

        // Supervisor
        User::create([
            'name' =&gt; 'Team Supervisor',
            'email' =&gt; 'supervisor@example.com',
            'password' =&gt; password_hash('password', PASSWORD_DEFAULT),
            'role' =&gt; 'supervisor',
        ]);

        // Regular Employee
        User::create([
            'name' =&gt; 'John Employee',
            'email' =&gt; 'employee@example.com',
            'password' =&gt; password_hash('password', PASSWORD_DEFAULT),
            'role' =&gt; 'employee',
        ]);
    }
}
</code></pre>

  <div class="alert alert-info">
    <strong>Syntax Explanation (Model::create)</strong>
    <ul>
      <li><code>User::create([...])</code> is Active Record style: "create a new row in table <code>users</code>".</li>
      <li><code>'role' =&gt; 'supervisor'</code> is a simple key/value pair, like a JavaScript object:
        <code>{ role: "supervisor" }</code>.</li>
      <li><code>password_hash()</code> hashes the password so it is not stored in plain text.</li>
      <li><strong>Fixed part:</strong> <code>User::create</code>, the <code>=&gt;</code> syntax, array brackets <code>[ ]</code>.</li>
      <li><strong>Custom part:</strong> names and emails, and the role labels
        (<code>'admin'</code>, <code>'supervisor'</code>, <code>'employee'</code>).</li>
    </ul>
  </div>

  <h3>3. Defining the Employee model</h3>
  <p>Create <code>app/models/Employee.php</code> to represent the employees table:</p>

  <pre><code class="language-php">&lt;?php

namespace App\Models;

use App\Core\Database\Model;

class Employee extends Model
{
    // Table name in the database
    protected static string $table = 'employees';

    // Primary key column (default is "id", so this line is optional)
    protected static string $primaryKey = 'id';

    // Mass-assignable fields when calling Employee::create([...])
    protected array $fillable = [
        'name',
        'email',
        'position',
        'department',
        'status',
        'supervisor_id',
    ];
}
</code></pre>

  <div class="alert alert-info">
    <strong>Syntax Explanation (Model)</strong>
    <ul>
      <li><code>class Employee extends Model</code> means "Employee is a model with database behavior".</li>
      <li><code>protected static string $table = 'employees';</code> ties the model to the <code>employees</code> table.</li>
      <li><code>$fillable</code> tells Bastion which columns can be filled from input safely.</li>
      <li><strong>Fixed part:</strong> <code>extends Model</code>, using the <code>App\Core\Database\Model</code> base class.</li>
      <li><strong>Custom part:</strong> the table name, column names and which fields you allow in <code>$fillable</code>.</li>
    </ul>
  </div>

  <h3>4. Employee CRUD API (+server.php endpoint)</h3>
  <p>
    Now create an API endpoint for employees at
    <code>app/api/employees/+server.php</code>. This will handle HTMX/JS calls
    for listing, creating and updating employees.
  </p>

  <pre><code class="language-php">&lt;?php

use App\Core\Http\Request;
use App\Core\Http\Response;
use App\Models\Employee;
use App\Core\Auth;

return [

    // GET /api/employees
    'get' =&gt; function (Request $request) {
        $user = Auth::user();

        // Only admin or supervisor can see the full list
        if (!in_array($user['role'], ['admin', 'supervisor'], true)) {
            return Response::json(['error' =&gt; 'Forbidden'], 403);
        }

        // Example queries using the Query Builder API
        $status = $request-&gt;query('status', 'active');

        $employees = Employee::query()
            -&gt;where('status', '=', $status)
            -&gt;orderBy('created_at', 'desc')
            -&gt;limit(50)
            -&gt;get();

        return Response::json($employees);
    },

    // POST /api/employees
    'post' =&gt; function (Request $request) {
        $user = Auth::user();

        if (!in_array($user['role'], ['admin', 'supervisor'], true)) {
            return Response::json(['error' =&gt; 'Forbidden'], 403);
        }

        $data = $request-&gt;validate([
            'name'         =&gt; 'required|string',
            'email'        =&gt; 'required|email',
            'position'     =&gt; 'required|string',
            'department'   =&gt; 'required|string',
            'status'       =&gt; 'required|string',
            'supervisor_id' =&gt; 'nullable|integer',
        ]);

        $employee = Employee::create($data);

        return Response::json($employee, 201);
    },

    // PATCH /api/employees/{id}
    'patch' =&gt; function (Request $request) {
        $user = Auth::user();

        if (!in_array($user['role'], ['admin', 'supervisor'], true)) {
            return Response::json(['error' =&gt; 'Forbidden'], 403);
        }

        $id = $request-&gt;route('id');

        $employee = Employee::find($id);
        if (!$employee) {
            return Response::json(['error' =&gt; 'Not Found'], 404);
        }

        $data = $request-&gt;validate([
            'position'   =&gt; 'sometimes|string',
            'department' =&gt; 'sometimes|string',
            'status'     =&gt; 'sometimes|string',
        ]);

        $employee-&gt;fill($data);
        $employee-&gt;save();

        return Response::json($employee);
    },
];
</code></pre>

  <div class="alert alert-info">
    <strong>Syntax Explanation (Query Builder &amp; Arrow <code>-&gt;</code>)</strong>
    <ul>
      <li>
        <code>Employee::query()</code> returns a <strong>Query Builder</strong> object for the
        <code>employees</code> table.
      </li>
      <li>
        <code>-&gt;</code> in PHP is like <code>.</code> in JavaScript or <code>.</code> in Python:
        it calls a method on an object. Each call returns the same builder, so you can chain:
        <code>query()-&gt;where(...)-&gt;orderBy(...)-&gt;limit(...)-&gt;get()</code>.
      </li>
      <li><code>where('status', '=', $status)</code> ‚Üí <code>WHERE status = ?</code> (safe, parameterized).</li>
      <li><code>orderBy('created_at', 'desc')</code> ‚Üí <code>ORDER BY created_at DESC</code>.</li>
      <li><code>limit(50)</code> ‚Üí <code>LIMIT 50</code>.</li>
      <li><code>get()</code> ‚Üí runs the SQL and returns an array of rows.</li>
      <li><code>find($id)</code> ‚Üí fetches a single row by primary key (or <code>null</code>).</li>
      <li><code>exists()</code>, <code>count()</code>, <code>first()</code> are also available for checks.</li>
      <li>
        <strong>Fixed part:</strong> method names like <code>where</code>, <code>orderBy</code>,
        <code>limit</code>, <code>get</code>, <code>find</code>.
      </li>
      <li>
        <strong>Custom part:</strong> column names (<code>'status'</code>), values (<code>$status</code>),
        and your business logic in <code>if</code> conditions.
      </li>
    </ul>
  </div>

  <h3>5. Employees UI page (layout + DV + components)</h3>
  <p>
    Finally, create an internal UI for supervisors and admins at
    <code>app/employees/page.php</code>. This page will:
  </p>
  <ul>
    <li>Check the logged-in user and role using <code>Auth</code>.</li>
    <li>Set page title via <code>dv()</code> so layouts can read it.</li>
    <li>Render a table using the <code>Data.Table</code> component.</li>
  </ul>

  <pre><code class="language-php">&lt;?php

use App\Core\Auth;
use App\Core\DV;
use App\Core\Database\DB;

// 1) Guard: only admin or supervisor can see this page
if (!Auth::check()) {
    return \App\Core\Http\Response::redirect('/login');
}

$user = Auth::user();

if (!in_array($user['role'], ['admin', 'supervisor'], true)) {
    return \App\Core\Http\Response::redirect('/dashboard');
}

// 2) Page state for layouts (DV Engine)
DV::set('title', 'Employees');

// 3) Fetch employees using the Query Builder
$employees = DB::table('employees')
    -&gt;orderBy('created_at', 'desc')
    -&gt;limit(100)
    -&gt;get();

// 4) Prepare headers and rows for the Data.Table component
$headers = ['ID', 'Name', 'Email', 'Position', 'Department', 'Status'];

$rows = array_map(function ($e) {
    return [
        $e['id'],
        e($e['name']),
        e($e['email']),
        e($e['position']),
        e($e['department']),
        component('Data.Badge', [
            'text'  =&gt; ucfirst($e['status']),
            'color' =&gt; $e['status'] === 'active' ? 'success' : 'warning',
        ]),
    ];
}, $employees);

$table = component('Data.Table', [
    'headers' =&gt; $headers,
    'rows'    =&gt; $rows,
]);

// 5) Render page content (the layout.php will wrap this)
echo &lt;&lt;&lt;HTML
&lt;div class="space-y-6"&gt;
  &lt;div class="flex items-center justify-between"&gt;
    &lt;h1 class="text-2xl font-bold text-white"&gt;Employees&lt;/h1&gt;
    &lt;div class="flex gap-2"&gt;
      &lt;!-- You can hook this button to an HTMX form or modal --&gt;
      &lt;?= component('Forms.Button', [
            'text' =&gt; 'New Employee',
            'variant' =&gt; 'primary',
            'size' =&gt; 'sm',
        ]) ?&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="bg-slate-900/40 border border-slate-700 rounded-xl p-4"&gt;
    {$table}
  &lt;/div&gt;
&lt;/div&gt;
HTML;
</code></pre>

  <div class="alert alert-info">
    <strong>Syntax Explanation (DV, components, layouts)</strong>
    <ul>
      <li><code>DV::set('title', 'Employees');</code> stores a value in the DV Engine, so
        <code>layout.php</code> can read it and put <code>&lt;title&gt;Employees&lt;/title&gt;</code> in the HTML head.</li>
      <li><code>component('Data.Table', ...)</code> loads a functional PHP component from
        <code>app/components/Data/Table.php</code> and returns HTML.</li>
      <li><code>e($e['name'])</code> escapes output to prevent XSS. Always wrap untrusted data in <code>e()</code>.</li>
      <li>
        The outer HTML is just a big string with Tailwind classes. Bastion's
        <code>layout.php</code> at the root (and optional <code>app/employees/layout.php</code>)
        will wrap this content automatically.
      </li>
      <li>
        <strong>Fixed part:</strong> functions <code>component()</code>, <code>e()</code>, the fact that
        the file is named <code>page.php</code>.
      </li>
      <li>
        <strong>Custom part:</strong> the Tailwind classes, text labels, which component names you use
        (<code>Data.Table</code>, <code>Forms.Button</code>), the columns you show, etc.
      </li>
    </ul>
  </div>

  <h3>6. How this maps to Bastion‚Äôs philosophy</h3>
  <p>
    This example uses every major idea of Bastion:
  </p>
  <ul>
    <li><strong>Monolith Modular:</strong> all code lives in <code>app/</code> as first-party code.</li>
    <li><strong>Hybrid Routing:</strong> <code>page.php</code> for UI and <code>+server.php</code> for API live under the same folder structure.</li>
    <li><strong>DV Engine:</strong> <code>DV::set()</code> bridges "controller" logic and layouts without globals.</li>
    <li><strong>Secure by default:</strong> roles are enforced at the edge (<code>Auth</code> checks), and UI uses <code>e()</code> for escaping.</li>
    <li><strong>Query Builder & ORM:</strong> readable SQL-like chains with parameter binding instead of raw strings.</li>
  </ul>

  <p>
    Your juniors can copy this pattern to build other internal tools: incidents,
    vacation requests, asset management, purchase orders ‚Äì always the same recipe:
    <strong>Model + Migration + +server.php + page.php + components + DV + layouts</strong>.
  </p>
      </section>

  <section id="structure">
  <h2>Directory Structure</h2>
  <p>
    A standardized, predictable structure for teams of any size. Bastion generates an
    enterprise-style monolith where the <code>app/</code> directory doubles as your
    file-based router, similar to Next.js, but fully in PHP.
  </p>

  <div class="file-tree">
    <div class="tree">
      <!-- APP ROOT -->
      <div class="tree-item">
        <span class="tree-icon">üìÇ</span>
        <span class="tree-hl">app/</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> api/
        <span style="margin-left:auto; opacity:0.5;">// REST/HTMX endpoints (+server.php)</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> components/
        <span style="margin-left:auto; opacity:0.5;">// Reusable UI components</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> core/
        <span style="margin-left:auto; opacity:0.5;">// Framework kernel (App, Router, DV, DB, ...)</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> http/
        <span style="margin-left:auto; opacity:0.5;">// Controllers, middleware, form requests</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> models/
        <span style="margin-left:auto; opacity:0.5;">// Domain models</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> providers/
        <span style="margin-left:auto; opacity:0.5;">// Service providers</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> services/
        <span style="margin-left:auto; opacity:0.5;">// Application services</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> views/
        <span style="margin-left:auto; opacity:0.5;">// Global layouts & error pages</span>
      </div>

      <div class="tree-item" style="padding-left: 40px;">
        <span class="tree-icon">üìÇ</span> layouts/
        <span style="margin-left:auto; opacity:0.5;">// app.php, guest.php, base shells</span>
      </div>

      <div class="tree-item" style="padding-left: 40px;">
        <span class="tree-icon">üìÇ</span> errors/
        <span style="margin-left:auto; opacity:0.5;">// 404.php, 500.php, etc.</span>
      </div>

      <!-- FILE-BASED ROUTER ROOT -->
      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÑ</span> layout.php
        <span style="margin-left:auto; opacity:0.5;">// Optional root router layout (wraps all routes)</span>
      </div>

      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÑ</span> page.php
        <span style="margin-left:auto; opacity:0.5;">// Root homepage route (/)</span>
      </div>

      <!-- EXAMPLE SECTION WITH ITS OWN LAYOUT -->
      <div class="tree-item" style="padding-left: 20px;">
        <span class="tree-icon">üìÇ</span> dashboard/
        <span style="margin-left:auto; opacity:0.5;">// /dashboard section</span>
      </div>

      <div class="tree-item" style="padding-left: 40px;">
        <span class="tree-icon">üìÑ</span> layout.php
        <span style="margin-left:auto; opacity:0.5;">// Layout for /dashboard/*</span>
      </div>

      <div class="tree-item" style="padding-left: 40px;">
        <span class="tree-icon">üìÑ</span> page.php
        <span style="margin-left:auto; opacity:0.5;">// /dashboard</span>
      </div>

      <div class="tree-item" style="padding-left: 40px;">
        <span class="tree-icon">üìÇ</span> analytics/
        <span style="margin-left:auto; opacity:0.5;">// /dashboard/analytics</span>
      </div>

      <div class="tree-item" style="padding-left: 60px;">
        <span class="tree-icon">üìÑ</span> page.php
        <span style="margin-left:auto; opacity:0.5;">// /dashboard/analytics page</span>
      </div>

      <!-- REST OF THE PROJECT -->
      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> config/
        <span style="margin-left:auto; opacity:0.5;">// App, database, auth, cache, mail, ...</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> database/
        <span style="margin-left:auto; opacity:0.5;">// migrations, seeds, factories</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> public/
        <span style="margin-left:auto; opacity:0.5;">// index.php, assets, web root</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> resources/
        <span style="margin-left:auto; opacity:0.5;">// Tailwind CSS, JS entrypoints</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> storage/
        <span style="margin-left:auto; opacity:0.5;">// logs, cache, sessions, compiled views</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÇ</span> tests/
        <span style="margin-left:auto; opacity:0.5;">// Unit & Feature tests</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÑ</span> bastion
        <span style="margin-left:auto; opacity:0.5;">// Bastion CLI entrypoint</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÑ</span> composer.json
        <span style="margin-left:auto; opacity:0.5;">// PHP dependencies & autoload</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÑ</span> package.json
        <span style="margin-left:auto; opacity:0.5;">// Frontend tooling & scripts</span>
      </div>

      <div class="tree-item">
        <span class="tree-icon">üìÑ</span> .env
        <span style="margin-left:auto; opacity:0.5;">// Environment configuration</span>
      </div>
    </div>
  </div>

  <p style="font-size:0.9rem; color:var(--text-dim); margin-top:0.75rem;">
    <strong>Layouts by folder:</strong> any directory under <code>app/</code> can include a
    <code>layout.php</code> next to its <code>page.php</code>. Bastion will automatically compose
    all matching <code>layout.php</code> files from the root <code>app/layout.php</code> down to the
    deepest folder that matches the current route, wrapping your page content layer by layer ‚Äî
    just like the Next.js App Router, but implemented in clean PHP.
  </p>
</section>
      <section id="lifecycle">
        <h2>Request Lifecycle</h2>
        <p>Understanding the flow of a request in Bastion is key to mastering the framework.</p>

        <ol style="list-style:decimal; margin-left:1.5rem;">
          <li>
            <strong>Entry (public/index.php):</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Web server directs traffic here. Loads Composer autoloader.</span>
          </li>
          <li>
            <strong>Bootstrap (app/bootstrap.php):</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Loads <code>.env</code>, initializes <code>App</code> container, registers error handlers.</span>
          </li>
          <li>
            <strong>Kernel Boot:</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Loops through <code>config/app.php</code> providers (DB connection, Auth setup).</span>
          </li>
          <li>
            <strong>Routing (Router::dispatch):</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Inspects URL. Traverses <code>app/</code> folders to find <code>page.php</code> or <code>+server.php</code>.</span>
          </li>
          <li>
            <strong>Middleware:</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Global stack runs (CSRF, Auth, Headers).</span>
          </li>
          <li>
            <strong>Logic Execution:</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Controller logic runs. If UI, it populates the <strong>DV Engine</strong>.</span>
          </li>
          <li>
            <strong>Rendering:</strong><br>
            <span style="color:var(--text-dim); font-size:0.9em;">Output captured, wrapped in nested <code>layout.php</code> files, and sent to browser.</span>
          </li>
        </ol>
      </section>

    
      <hr />

      <section id="ioc">
        <h2>The IoC Container</h2>
        <p>
          Bastion is driven by a powerful <strong>Inversion of Control (IoC) Container</strong> located at <code>App\Core\Container</code>. 
          Unlike legacy PHP scripts that rely on <code>new ClassName()</code> or global state, Bastion manages class dependencies automatically using PHP's Reflection API.
        </p>

        <div class="alert alert-info">
          <span class="alert-title">Why use an IoC Container?</span>
          It decouples your classes. Instead of hardcoding dependencies inside your controllers, you request them via the constructor. 
          This makes your code testable, flexible, and clean.
        </div>

        <h3>Automatic Injection (Zero Config)</h3>
        <p>
          You rarely need to register classes manually. Simply type-hint your dependencies in your class constructors, 
          and the Container will resolve them recursively.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-keyword)">namespace</span> App\Services;

<span style="color:var(--tok-keyword)">use</span> App\Core\Database\DB;
<span style="color:var(--tok-keyword)">use</span> App\Core\Auth;

<span style="color:var(--tok-keyword)">class</span> <span style="color:var(--tok-class)">ReportGenerator</span> {
    <span style="color:var(--tok-keyword)">protected</span> <span style="color:var(--tok-variable)">$db</span>;
    <span style="color:var(--tok-keyword)">protected</span> <span style="color:var(--tok-variable)">$auth</span>;

    <span style="color:var(--tok-comment)">// The Container automatically injects the Database and Auth instances</span>
    <span style="color:var(--tok-keyword)">public function</span> <span style="color:var(--tok-function)">__construct</span>(DB <span style="color:var(--tok-variable)">$db</span>, Auth <span style="color:var(--tok-variable)">$auth</span>) {
        <span style="color:var(--tok-variable)">$this</span>->db = <span style="color:var(--tok-variable)">$db</span>;
        <span style="color:var(--tok-variable)">$this</span>->auth = <span style="color:var(--tok-variable)">$auth</span>;
    }
}</code></pre>

        <h3>Manual Binding & Singletons</h3>
        <p>
          Sometimes you need to bind an interface to a concrete implementation, or ensure only one instance of a class exists throughout the request lifecycle (Singleton). 
          This is configured in your <strong>Service Providers</strong>.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-comment)">// app/providers/AppServiceProvider.php</span>

<span style="color:var(--tok-keyword)">public function</span> <span style="color:var(--tok-function)">register</span>() {
    <span style="color:var(--tok-comment)">// Bind a Singleton: Created once, shared everywhere</span>
    <span style="color:var(--tok-variable)">$this</span>->app-><span style="color:var(--tok-function)">singleton</span>(
        PaymentGateway::class, 
        <span style="color:var(--tok-keyword)">fn</span>() => <span style="color:var(--tok-keyword)">new</span> StripeGateway(env(<span style="color:var(--tok-string)">'STRIPE_KEY'</span>))
    );
}</code></pre>
      </section>

      <section id="providers">
        <h2>Service Providers</h2>
        <p>
          Providers are the bootstrapping mechanism for your application. They are the central place to configure bindings, 
          register middleware, and set up event listeners before the application handles the request.
        </p>
        <p>
          Bastion comes with several default providers located in <code>app/providers/</code>:
        </p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th width="30%">Provider</th>
                <th>Responsibility</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>AppServiceProvider</code></td>
                <td>General application bootstrapping and global container bindings.</td>
              </tr>
              <tr>
                <td><code>DatabaseServiceProvider</code></td>
                <td>Establishes the PDO connection based on environment variables and boots the ORM.</td>
              </tr>
              <tr>
                <td><code>RouteServiceProvider</code></td>
                <td>(Optional) Used for advanced route pattern definitions or model binding logic.</td>
              </tr>
              <tr>
                <td><code>AuthServiceProvider</code></td>
                <td>Configures authentication guards, gates, and policies.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="config">
        <h2>Configuration System</h2>
        <p>
          Configuration files are stored in the <code>config/</code> directory. They return simple PHP arrays. 
          You can access them globally using the <code>config()</code> helper with dot-notation.
        </p>

        <div class="file-tree" style="margin-bottom: 1.5rem;">
          <div class="ft-item"><span class="ft-icon">üìÑ</span> config/app.php <span class="ft-meta">Debug mode, Timezone, URL</span></div>
          <div class="ft-item"><span class="ft-icon">üìÑ</span> config/database.php <span class="ft-meta">DB Connections (SQLite, MySQL)</span></div>
          <div class="ft-item"><span class="ft-icon">üìÑ</span> config/auth.php <span class="ft-meta">JWT Settings, Guards</span></div>
        </div>

        <pre><code class="language-php"><span style="color:var(--tok-comment)">// Get a configuration value</span>
<span style="color:var(--tok-variable)">$debug</span> = <span style="color:var(--tok-function)">config</span>(<span style="color:var(--tok-string)">'app.debug'</span>);

<span style="color:var(--tok-comment)">// Get a nested value with a default fallback</span>
<span style="color:var(--tok-variable)">$driver</span> = <span style="color:var(--tok-function)">config</span>(<span style="color:var(--tok-string)">'database.connections.mysql.driver'</span>, <span style="color:var(--tok-string)">'sqlite'</span>);
</code></pre>
      </section>
<section id="helpers">
  <h2>Helpers Reference</h2>
  <p>
    Bastion exposes a small set of global helper functions to keep your
    <code>page.php</code>, <code>layout.php</code> and components clean. They are registered
    by the core and available everywhere.
  </p>

  <table>
    <thead>
      <tr>
        <th>Helper</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>dv($key, $value = null)</code></td>
        <td>
          Get or set a value in the DV (Data View) engine. When called with two args,
          it sets. With one arg, it gets.
        </td>
        <td><code>dv('title', 'Dashboard'); dv('title');</code></td>
      </tr>
      <tr>
        <td><code>component($name, array $props = [])</code></td>
        <td>
          Render a PHP component from <code>app/components</code> using dotted notation.
        </td>
        <td><code>component('Forms.Button', ['text' =&gt; 'Save']);</code></td>
      </tr>
      <tr>
        <td><code>config($key, $default = null)</code></td>
        <td>
          Read configuration values from <code>config/*.php</code> using dot notation.
        </td>
        <td><code>config('app.name');</code></td>
      </tr>
      <tr>
        <td><code>env($key, $default = null)</code></td>
        <td>
          Read environment variables from <code>.env</code> or the process environment.
        </td>
        <td><code>env('APP_ENV', 'production');</code></td>
      </tr>
      <tr>
        <td><code>request()</code></td>
        <td>
          Get the current <code>Request</code> instance inside a view or component.
        </td>
        <td><code>request()->path;</code></td>
      </tr>
      <tr>
        <td><code>response()</code></td>
        <td>
          Shortcut to <code>Response</code> static helpers (HTML, JSON, redirect).
        </td>
        <td><code>return response()->redirect('/login');</code></td>
      </tr>
      <tr>
        <td><code>asset($path)</code></td>
        <td>
          Generate the correct public URL for compiled assets under <code>public/</code>.
        </td>
        <td><code>&lt;link rel="stylesheet" href="&lt;?= asset('assets/css/app.css') ?&gt;"&gt;</code></td>
      </tr>
      <tr>
        <td><code>csrf_token()</code></td>
        <td>
          Get the current CSRF token stored in the session.
        </td>
        <td><code>&lt;meta name="csrf-token" content="&lt;?= csrf_token() ?&gt;"&gt;</code></td>
      </tr>
      <tr>
        <td><code>csrf_field()</code></td>
        <td>
          Render a hidden input with the CSRF token to include inside forms.
        </td>
        <td><code>&lt;form&gt; &lt;?= csrf_field() ?&gt; ... &lt;/form&gt;</code></td>
      </tr>
      <tr>
        <td><code>auth()</code></td>
        <td>
          Access authentication helpers, current user, guards and checks.
        </td>
        <td><code>if (auth()-&gt;check()) { echo auth()-&gt;user()['email']; }</code></td>
      </tr>
      <tr>
        <td><code>logger()</code></td>
        <td>
          Write messages to the Bastion log file in <code>storage/logs</code>.
        </td>
        <td><code>logger()-&gt;info('User logged in', ['id' =&gt; $userId]);</code></td>
      </tr>
    </tbody>
  </table>

  <p style="font-size:0.9rem; color:var(--text-dim);">
    These helpers are registered by the <code>AppServiceProvider</code> when the framework
    boots. You can add your own helpers in <code>app/core/helpers.php</code> or a similar
    file and include them from the bootstrap code.
  </p>
</section>
      <section id="facades">
        <h2>Global Helpers</h2>
        <p>
          To increase developer velocity, Bastion provides a suite of global helper functions defined in <code>app/core/helpers.php</code>. 
          These functions act as shortcuts to core framework features.
        </p>

        <div class="table-wrapper">
          <table>
            <thead><tr><th>Helper</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>app()</code></td><td>Get the IoC Container instance or resolve a class.</td></tr>
              <tr><td><code>base_path($path)</code></td><td>Get absolute path to the project root.</td></tr>
              <tr><td><code>config($key)</code></td><td>Get a configuration value using dot notation.</td></tr>
              <tr><td><code>dv($key, $val)</code></td><td>Get/Set Data View state (replaces global variables).</td></tr>
              <tr><td><code>e($str)</code></td><td>Escape HTML entities (XSS Protection).</td></tr>
              <tr><td><code>env($key)</code></td><td>Get an environment variable from <code>.env</code>.</td></tr>
              <tr><td><code>request()</code></td><td>Get the current HTTP Request instance.</td></tr>
              <tr><td><code>response()</code></td><td>Create a new HTTP Response factory.</td></tr>
              <tr><td><code>csrf_field()</code></td><td>Generate a hidden <code>&lt;input&gt;</code> with the CSRF token.</td></tr>
              <tr><td><code>component($name)</code></td><td>Render a functional UI component from <code>app/components</code>.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <hr />

      <section id="hybrid-routing">
        <h2>Hybrid Routing System</h2>
        <p>
          Bastion introduces a unique routing paradigm that separates <strong>UI Logic</strong> from <strong>Data Logic</strong> 
          using file conventions within the same directory structure. This solves the "Controller Bloat" problem common in MVC frameworks 
          and aligns with modern "App Router" patterns found in Next.js and SvelteKit.
        </p>

        <div class="features-grid">
          <div class="feature-card">
            <h4 style="color:var(--primary-light); margin-top:0;">1. UI Routes (page.php)</h4>
            <p style="font-size:0.9rem;">Executed on <code>GET</code> requests. Designed to handle view logic and render HTML. Automatically wrapped in layouts.</p>
            <div style="margin-top:1rem; padding:0.5rem; background:rgba(0,0,0,0.3); border-radius:4px; font-size:0.8rem; font-family:'JetBrains Mono'; opacity:0.8;">Example: app/dashboard/page.php</div>
          </div>
          <div class="feature-card">
            <h4 style="color:var(--secondary); margin-top:0;">2. API Routes (+server.php)</h4>
            <p style="font-size:0.9rem;">Handles data methods (POST, PUT, DELETE). Returns strictly typed Responses (usually JSON). Ideal for HTMX endpoints.</p>
            <div style="margin-top:1rem; padding:0.5rem; background:rgba(0,0,0,0.3); border-radius:4px; font-size:0.8rem; font-family:'JetBrains Mono'; opacity:0.8;">Example: app/api/users/+server.php</div>
          </div>
        </div>

        <h3>Dynamic Parameters</h3>
        <p>Use square brackets <code>[param]</code> to create dynamic route segments. The router automatically extracts these values.</p>
        
        <pre><code class="language-php"><span style="color:var(--tok-comment)">// Directory: app/users/[id]/page.php</span>
<span style="color:var(--tok-comment)">// Request:   GET /users/42</span>

<span style="color:var(--tok-variable)">$id</span> = <span style="color:var(--tok-function)">request</span>()->attributes[<span style="color:var(--tok-string)">'id'</span>]; <span style="color:var(--tok-comment)">// "42"</span>
<span style="color:var(--tok-variable)">$user</span> = User::<span style="color:var(--tok-function)">find</span>(<span style="color:var(--tok-variable)">$id</span>);
</code></pre>
      </section>

      <section id="ui-pages">
        <h2>UI Pages (page.php)</h2>
        <p>
          A <code>page.php</code> file represents a viewable page in your browser. When accessed, Bastion:
        </p>
        <ol>
          <li>Executes the logic inside <code>page.php</code> (Controller logic).</li>
          <li>Captures any output or return values.</li>
          <li>Resolves the nested <code>layout.php</code> chain from the root directory down to the current directory.</li>
          <li>Injects the page content into the innermost layout.</li>
        </ol>

        <pre><code class="language-php"><span style="color:var(--tok-comment)">// app/dashboard/page.php</span>
<span style="color:var(--tok-keyword)">use</span> App\Core\Auth;

<span style="color:var(--tok-comment)">// 1. Logic Gate</span>
<span style="color:var(--tok-keyword)">if</span> (!Auth::<span style="color:var(--tok-function)">check</span>()) {
    <span style="color:var(--tok-keyword)">return</span> Response::<span style="color:var(--tok-function)">redirect</span>(<span style="color:var(--tok-string)">'/login'</span>);
}

<span style="color:var(--tok-comment)">// 2. Set State for Layouts</span>
<span style="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'title'</span>, <span style="color:var(--tok-string)">'My Dashboard'</span>);

<span style="color:var(--tok-comment)">// 3. Render Content</span>
<span style="color:var(--tok-keyword)">echo</span> <span style="color:var(--tok-function)">component</span>(<span style="color:var(--tok-string)">'Layout.WelcomeBanner'</span>, [<span style="color:var(--tok-string)">'user'</span> => Auth::<span style="color:var(--tok-function)">user</span>()]);
</code></pre>
      </section>
<section id="layouts">
  <h2>Layouts (layout.php)</h2>
  <p>
    Bastion uses a <strong>per-folder layout system</strong> very similar to the
    <strong>Next.js App Router</strong>. Any directory inside <code>app/</code> can define a
    <code>layout.php</code> next to its <code>page.php</code>. That layout wraps all pages
    and nested routes inside that directory.
  </p>

  <h3>Mental model</h3>
  <p>
    For a given URL, the router:
  </p>
  <ol>
    <li>Resolves the directory that contains the matching <code>page.php</code>.</li>
    <li>Walks up directory by directory until it reaches the <code>app/</code> root.</li>
    <li>At each level, if a <code>layout.php</code> exists, it is added to a layout chain.</li>
    <li>Renders the <code>page.php</code> and wraps its HTML with each <code>layout.php</code> from outermost to innermost.</li>
  </ol>

  <h3>Example route tree</h3>
  <p>Consider this structure inside <code>app/</code>:</p>

  <pre><code class="language-text">app/
  layout.php               // Router root layout (optional)
  page.php                 // Home "/"

  dashboard/
    layout.php             // Layout for all "/dashboard/*"
    page.php               // "/dashboard"

    analytics/
      page.php             // "/dashboard/analytics"</code></pre>

  <p>For the URL <code>/dashboard/analytics</code>, the layout order is:</p>

  <ol>
    <li><code>app/layout.php</code> (router root layout, if present)</li>
    <li><code>app/dashboard/layout.php</code> (dashboard section layout)</li>
    <li><code>app/dashboard/analytics/page.php</code> (leaf page content)</li>
  </ol>

  <p>
    On top of that, the final HTML is usually wrapped by the global view layout
    <code>app/views/layouts/app.php</code>, which defines the <code>&lt;html&gt;</code>,
    <code>&lt;head&gt;</code> and shared navigation shell of the system.
  </p>

  <h3>Writing a section layout</h3>
  <p>
    A <code>layout.php</code> file is just a PHP template that receives a
    <code>$content</code> variable containing the inner page HTML. You can also interact
    with the DV (Data View) engine from here.
  </p>

  <pre><code class="language-php">&lt;?php
// app/dashboard/layout.php

// Optionally adjust the title using the DV engine
dv('title', 'Dashboard ¬∑ ' . dv('title', 'Bastion App'));
?&gt;

&lt;div class="min-h-screen bg-slate-950 text-slate-100"&gt;
  &lt;div class="flex"&gt;
    &lt;aside class="w-64 border-r border-slate-800 p-4"&gt;
      &lt;h1 class="text-lg font-semibold mb-4"&gt;Dashboard&lt;/h1&gt;
      &lt;nav class="space-y-2 text-sm text-slate-400"&gt;
        &lt;a href="/dashboard" class="block hover:text-white"&gt;Overview&lt;/a&gt;
        &lt;a href="/dashboard/analytics" class="block hover:text-white"&gt;Analytics&lt;/a&gt;
      &lt;/nav&gt;
    &lt;/aside&gt;

    &lt;main class="flex-1 p-8"&gt;
      &lt;?= $content ?&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

  <h3>Comparison with Next.js</h3>
  <p>
    If you come from Next.js (App Router), think of it like this:
  </p>
  <ul>
    <li><code>app/views/layouts/app.php</code> ‚âà global <code>app/layout.tsx</code> for the whole project.</li>
    <li><code>app/layout.php</code> ‚âà router root layout.</li>
    <li><code>app/dashboard/layout.php</code> ‚âà section layout for <code>/dashboard</code>.</li>
    <li><code>page.php</code> ‚âà individual page components at each route level.</li>
  </ul>

  <p>
    The Bastion router automatically discovers and composes all relevant
    <code>layout.php</code> files by walking directories from the route root down to the
    deepest folder for the current request.
  </p>
</section>
      <section id="api-endpoints">
  <h2>API Endpoints (+server.php)</h2>
  <p>
    Bastion treats any <code>+server.php</code> file under <code>app/api</code> as an HTTP
    endpoint. Each file returns an associative array that maps HTTP methods (in lowercase)
    to handler functions, similar to FastAPI‚Äôs <em>path operations</em>.
  </p>

  <h3>Rule of the game</h3>
  <ul>
    <li>Folder path under <code>app/api</code> = URL path under <code>/api</code>.</li>
    <li>File name is always <code>+server.php</code>.</li>
    <li>The file must <strong>return an array</strong> with keys like <code>'get'</code>, <code>'post'</code>, <code>'delete'</code>, etc.</li>
    <li>Each value is a <code>callable</code> that receives a <code>Request</code> and returns a <code>Response</code> or raw output.</li>
  </ul>

  <h3>Example: users collection</h3>
  <pre><code class="language-php">&lt;?php
// app/api/users/+server.php

use App\Core\Request;
use App\Core\Response;
use App\Models\User;
use App\Core\Auth;

return [

    // GET /api/users
    'get' =&gt; function (Request $request) {
        if (!Auth::check()) {
            return Response::json(['error' =&gt; 'Unauthorized'], 401);
        }

        $users = User::all();
        return Response::json($users);
    },

    // POST /api/users
    'post' =&gt; function (Request $request) {
        $data = $request->validate([
            'name'  =&gt; 'required|string|min:3',
            'email' =&gt; 'required|email',
        ]);

        $user = User::create($data);

        return Response::json($user, 201);
    },

];</code></pre>

  <h3>Dynamic routes</h3>
  <p>
    Dynamic segments work the same way they do for <code>page.php</code> files. Use square brackets
    in folder names:
  </p>

  <pre><code class="language-text">app/api/
  users/
    +server.php          ‚Üí  /api/users
  users/[id]/
    +server.php          ‚Üí  /api/users/123</code></pre>

  <p>
    Inside the handler you can access route parameters via
    <code>$request->attributes['id']</code>:
  </p>

  <pre><code class="language-php">&lt;?php
// app/api/users/[id]/+server.php

use App\Core\Request;
use App\Core\Response;
use App\Models\User;

return [

    // DELETE /api/users/{id}
    'delete' =&gt; function (Request $request) {
        $id = $request->attributes['id'] ?? null;

        if (!$id || !User::find($id)) {
            return Response::json(['error' =&gt; 'User not found'], 404);
        }

        User::delete($id);
        return Response::json(null, 204);
    },

];</code></pre>

  <h3>Method not allowed (405)</h3>
  <p>
    If the request‚Äôs HTTP method does not exist in the returned array, Bastion automatically
    responds with <code>405 Method Not Allowed</code>. To support a new method, just add the
    corresponding key to the array (<code>'put'</code>, <code>'patch'</code>, etc.).
  </p>
</section>

      <section id="middleware">
        <h2>Middleware System</h2>
        <p>
          Middleware provide a convenient mechanism for inspecting and filtering HTTP requests entering your application.
          Bastion includes several critical middleware by default:
        </p>
        
        <ul style="list-style: none; padding: 0;">
          <li style="margin-bottom: 1rem; border-left: 2px solid var(--border-mid); padding-left: 1rem;">
            <strong>üîê AuthMiddleware:</strong> Verifies JWT tokens and ensures user sessions are valid.
          </li>
          <li style="margin-bottom: 1rem; border-left: 2px solid var(--border-mid); padding-left: 1rem;">
            <strong>üõ°Ô∏è CsrfMiddleware:</strong> Automatically protects against Cross-Site Request Forgery on state-changing methods.
          </li>
          <li style="margin-bottom: 1rem; border-left: 2px solid var(--border-mid); padding-left: 1rem;">
            <strong>üîí SecurityHeaders:</strong> Injects security headers like CSP (Content Security Policy) and X-Frame-Options.
          </li>
        </ul>

        <h3>Creating Custom Middleware</h3>
        <p>Middleware are simple classes with a <code>handle</code> method that receives the request and a closure to proceed.</p>

        <pre><code class="language-php"><span style="color:var(--tok-keyword)">namespace</span> App\Http\Middleware;

<span style="color:var(--tok-keyword)">class</span> <span style="color:var(--tok-class)">AdminOnly</span> {
    <span style="color:var(--tok-keyword)">public function</span> <span style="color:var(--tok-function)">handle</span>(<span style="color:var(--tok-variable)">$request</span>, <span style="color:var(--tok-variable)">$next</span>) {
        <span style="color:var(--tok-keyword)">if</span> (!Auth::<span style="color:var(--tok-function)">user</span>()->isAdmin) {
            <span style="color:var(--tok-keyword)">return</span> Response::<span style="color:var(--tok-function)">error</span>(<span style="color:var(--tok-class)">403</span>, <span style="color:var(--tok-string)">'Forbidden: Admin Access Required'</span>);
        }
        <span style="color:var(--tok-keyword)">return</span> <span style="color:var(--tok-variable)">$next</span>(<span style="color:var(--tok-variable)">$request</span>);
    }
}</code></pre>
      </section>

      <hr />

      <section id="dv-engine">
        <h2>The DV Engine (Data View)</h2>
        <div class="alert alert-info">
          <span class="alert-title">Solving the Data Flow Problem</span>
          In file-based routing, the "Page" (Inner Content) runs <em>before</em> the "Layout" (Outer Wrapper). 
          Passing data "up" the chain (e.g., setting the page title in the HTML head) historically required global variables. 
          <strong>Bastion solves this with the DV Static Container.</strong>
        </div>

        <p>The <code>DV</code> (Data View) class acts as a synchronized state store for the current request lifecycle.</p>

        <div class="features-grid">
          <div class="feature-card">
            <div class="fc-title" style="font-size:1rem;">Controller Logic</div>
            <p class="fc-desc" style="font-size:0.8rem; margin-top:0.5rem;">Inside <code>app/dashboard/page.php</code></p>
            <pre style="margin:1rem 0 0; padding:1rem; font-size:0.75rem;"><code class="language-php"><span style="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'page_title'</span>, <span style="color:var(--tok-string)">'Sales'</span>);
<span class="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'user'</span>, Auth::<span style="color:var(--tok-function)">user</span>());</code></pre>
          </div>
          <div class="feature-card">
            <div class="fc-title" style="font-size:1rem;">View Logic</div>
            <p class="fc-desc" style="font-size:0.8rem; margin-top:0.5rem;">Inside <code>app/views/layouts/app.php</code></p>
            <pre style="margin:1rem 0 0; padding:1rem; font-size:0.75rem;"><code class="language-php">&lt;title&gt;<span style="color:var(--tok-function)">&lt;?=</span> <span style="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'page_title'</span>) <span style="color:var(--tok-function)">?&gt;</span>&lt;/title&gt;
&lt;nav&gt;Hi, <span style="color:var(--tok-function)">&lt;?=</span> <span style="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'user'</span>)[<span style="color:var(--tok-string)">'name'</span>] <span style="color:var(--tok-function)">?&gt;</span>&lt;/nav&gt;</code></pre>
          </div>
        </div>
      </section>

      <section id="session">
        <h2>Session & Flash Data</h2>
        <p>
          Bastion provides a secure wrapper around PHP's native sessions. It automatically handles 
          <code>HttpOnly</code>, <code>SameSite</code>, and <code>Secure</code> flags based on your environment configuration.
        </p>

        <h3>Flash Data</h3>
        <p>
          "Flash" data is stored in the session for the <strong>next request only</strong>. 
          It is perfect for status messages like "User Created" or form validation errors after a redirect.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-comment)">// In your Controller (+server.php)</span>
\App\Core\DV::<span style="color:var(--tok-function)">flash</span>(<span style="color:var(--tok-string)">'success'</span>, <span style="color:var(--tok-string)">'Profile updated successfully!'</span>);
<span style="color:var(--tok-keyword)">return</span> Response::<span style="color:var(--tok-function)">redirect</span>(<span style="color:var(--tok-string)">'/profile'</span>);

<span style="color:var(--tok-comment)">// In your View (page.php)</span>
<span style="color:var(--tok-keyword)">if</span> (<span style="color:var(--tok-variable)">$msg</span> = <span style="color:var(--tok-function)">dv</span>(<span style="color:var(--tok-string)">'success'</span>)) {
    <span style="color:var(--tok-keyword)">echo</span> <span style="color:var(--tok-function)">component</span>(<span style="color:var(--tok-string)">'Feedback.Alert'</span>, [
        <span style="color:var(--tok-string)">'text'</span> => <span style="color:var(--tok-variable)">$msg</span>, 
        <span style="color:var(--tok-string)">'type'</span> => <span style="color:var(--tok-string)">'success'</span>
    ]);
}
</code></pre>
      </section>
      <hr />

      <section id="database">
        <h2>Database & Connection</h2>
        <p>
          Bastion ships with a robust Database Abstraction Layer supporting <strong>SQLite</strong>, <strong>MySQL</strong>, and <strong>PostgreSQL</strong>.
          The connection is handled via PDO with secure defaults (prepared statements, exception mode).
        </p>

        <div class="alert alert-info">
          <span class="alert-title">SQLite Optimization</span>
          By default, Bastion enables <strong>WAL Mode (Write-Ahead Logging)</strong> for SQLite connections. 
          This allows concurrent readers and writers, making SQLite suitable for high-traffic internal tools without locking issues.
        </div>

        <h3>Configuration</h3>
        <p>Database settings are defined in <code>.env</code> and mapped in <code>config/database.php</code>.</p>

        <pre><code class="language-ini"><span style="color:var(--tok-comment)"># .env</span>
<span style="color:var(--tok-variable)">DB_CONNECTION</span>=sqlite
<span style="color:var(--tok-variable)">DB_DATABASE</span>=storage/database.sqlite

<span style="color:var(--tok-comment)"># For MySQL</span>
<span style="color:var(--tok-variable)">DB_CONNECTION</span>=mysql
<span style="color:var(--tok-variable)">DB_HOST</span>=127.0.0.1
<span style="color:var(--tok-variable)">DB_DATABASE</span>=bastion_app
<span style="color:var(--tok-variable)">DB_USERNAME</span>=root
<span style="color:var(--tok-variable)">DB_PASSWORD</span>=secret</code></pre>
      </section>

      <section id="query-builder">
        <h2>Fluent Query Builder</h2>
        <p>
          The Query Builder provides a convenient, fluent interface to create and run database queries. 
          It protects against SQL Injection using parameter binding automatically.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-keyword)">use</span> App\Core\Database\DB;

<span style="color:var(--tok-comment)">// Select with constraints</span>
<span style="color:var(--tok-variable)">$users</span> = DB::<span style="color:var(--tok-function)">table</span>(<span style="color:var(--tok-string)">'users'</span>)
    -><span style="color:var(--tok-function)">where</span>(<span style="color:var(--tok-string)">'active'</span>, <span style="color:var(--tok-class)">1</span>)
    -><span style="color:var(--tok-function)">where</span>(<span style="color:var(--tok-string)">'role'</span>, <span style="color:var(--tok-string)">'admin'</span>)
    -><span style="color:var(--tok-function)">orderBy</span>(<span style="color:var(--tok-string)">'created_at'</span>, <span style="color:var(--tok-string)">'desc'</span>)
    -><span style="color:var(--tok-function)">limit</span>(<span style="color:var(--tok-class)">10</span>)
    -><span style="color:var(--tok-function)">get</span>();

<span style="color:var(--tok-comment)">// Insert</span>
<span style="color:var(--tok-variable)">$id</span> = DB::<span style="color:var(--tok-function)">table</span>(<span style="color:var(--tok-string)">'logs'</span>)-><span style="color:var(--tok-function)">insert</span>([
    <span style="color:var(--tok-string)">'action'</span> => <span style="color:var(--tok-string)">'login'</span>,
    <span style="color:var(--tok-string)">'user_id'</span> => <span style="color:var(--tok-class)">1</span>
]);
</code></pre>

        <div class="table-wrapper">
          <table>
            <thead><tr><th>Method</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>table($name)</code></td><td>Begin a query against a specific table.</td></tr>
              <tr><td><code>select(...$cols)</code></td><td>Specify columns to retrieve (default <code>*</code>).</td></tr>
              <tr><td><code>where($col, $op, $val)</code></td><td>Add a basic WHERE clause.</td></tr>
              <tr><td><code>orWhere(...)</code></td><td>Add a WHERE clause joined by OR.</td></tr>
              <tr><td><code>orderBy($col, $dir)</code></td><td>Sort the results.</td></tr>
              <tr><td><code>limit($int)</code></td><td>Limit the number of results.</td></tr>
              <tr><td><code>get()</code></td><td>Execute query and return array of results.</td></tr>
              <tr><td><code>first()</code></td><td>Execute query and return the first result object.</td></tr>
              <tr><td><code>count()</code></td><td>Return the integer count of records.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="orm">
        <h2>Models (Active Record)</h2>
        <p>
          Bastion includes an Active Record implementation similar to Eloquent. 
          Models live in <code>app/models</code> and extend <code>App\Core\Database\Model</code>.
        </p>

        <h3>Defining a Model</h3>
        <pre><code class="language-php"><span style="color:var(--tok-keyword)">namespace</span> App\Models;
<span style="color:var(--tok-keyword)">use</span> App\Core\Database\Model;

<span style="color:var(--tok-keyword)">class</span> <span style="color:var(--tok-class)">Product</span> <span style="color:var(--tok-keyword)">extends</span> <span style="color:var(--tok-class)">Model</span> {
    <span style="color:var(--tok-comment)">// Optional: inferred from class name (Product -> products)</span>
    <span style="color:var(--tok-keyword)">protected static string</span> <span style="color:var(--tok-variable)">$table</span> = <span style="color:var(--tok-string)">'products'</span>;
    
    <span style="color:var(--tok-comment)">// Optional: Primary Key</span>
    <span style="color:var(--tok-keyword)">protected static string</span> <span style="color:var(--tok-variable)">$primaryKey</span> = <span style="color:var(--tok-string)">'id'</span>;
}
</code></pre>

        <h3>Usage</h3>
        <pre><code class="language-php"><span style="color:var(--tok-comment)">// Find by Primary Key</span>
<span style="color:var(--tok-variable)">$prod</span> = Product::<span style="color:var(--tok-function)">find</span>(<span style="color:var(--tok-class)">1</span>);

<span style="color:var(--tok-comment)">// Update Attribute</span>
<span style="color:var(--tok-variable)">$prod</span>->price = <span style="color:var(--tok-class)">199.99</span>;
<span style="color:var(--tok-variable)">$prod</span>-><span style="color:var(--tok-function)">save</span>();

<span style="color:var(--tok-comment)">// Create New</span>
<span style="color:var(--tok-variable)">$user</span> = User::<span style="color:var(--tok-function)">create</span>([
    <span style="color:var(--tok-string)">'name'</span> => <span style="color:var(--tok-string)">'Alice'</span>,
    <span style="color:var(--tok-string)">'email'</span> => <span style="color:var(--tok-string)">'alice@corp.com'</span>
]);
</code></pre>
      </section>

      <section id="migrations">
        <h2>Migrations & Schema</h2>
        <p>
          Migrations are like version control for your database. Bastion provides a schema builder to define tables agnostic of the database driver.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-keyword)">use</span> App\Core\Database\Schema\Schema;
<span style="color:var(--tok-keyword)">use</span> App\Core\Database\Schema\Blueprint;

<span style="color:var(--tok-keyword)">return new class</span> {
    <span style="color:var(--tok-keyword)">public function</span> <span style="color:var(--tok-function)">up</span>() {
        Schema::<span style="color:var(--tok-function)">create</span>(<span style="color:var(--tok-string)">'posts'</span>, <span style="color:var(--tok-keyword)">function</span>(Blueprint <span style="color:var(--tok-variable)">$table</span>) {
            <span style="color:var(--tok-variable)">$table</span>-><span style="color:var(--tok-function)">id</span>();
            <span style="color:var(--tok-variable)">$table</span>-><span style="color:var(--tok-function)">string</span>(<span style="color:var(--tok-string)">'title'</span>);
            <span style="color:var(--tok-variable)">$table</span>-><span style="color:var(--tok-function)">text</span>(<span style="color:var(--tok-string)">'content'</span>);
            <span style="color:var(--tok-variable)">$table</span>-><span style="color:var(--tok-function)">boolean</span>(<span style="color:var(--tok-string)">'is_published'</span>)-><span style="color:var(--tok-function)">default</span>(<span style="color:var(--tok-class)">false</span>);
            <span style="color:var(--tok-variable)">$table</span>-><span style="color:var(--tok-function)">timestamps</span>();
        });
    }

    <span style="color:var(--tok-keyword)">public function</span> <span style="color:var(--tok-function)">down</span>() {
        Schema::<span style="color:var(--tok-function)">drop</span>(<span style="color:var(--tok-string)">'posts'</span>);
    }
};</code></pre>

        <p>Run migrations using the CLI:</p>
        <pre><code class="language-bash">php bastion migrate</code></pre>
      </section>

      <hr />

      <section id="tailwind">
        <h2>Frontend: Tailwind v4</h2>
        <div class="alert alert-warn">
          <span class="alert-title">Architecture Shift: CSS-First</span>
          Bastion v1.0.0 uses the <strong>Tailwind CSS v4</strong> architecture. 
          We have eliminated <code>tailwind.config.js</code>. Configuration now lives inside your CSS file.
        </div>

        <h3>Configuration</h3>
        <p>Edit <code>resources/css/app.css</code> to configure your theme.</p>

        <pre><code class="language-css"><span style="color:var(--tok-comment)">/* resources/css/app.css */</span>
<span style="color:var(--tok-keyword)">@import</span> "tailwindcss";

<span style="color:var(--tok-keyword)">@theme</span> {
  <span style="color:var(--tok-comment)">/* Define custom theme variables here */</span>
  --color-brand-primary: #38bdf8;
  --color-brand-dark: #020617;
  
  --font-sans: 'Inter', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

<span style="color:var(--tok-keyword)">@layer</span> components {
  .btn-primary {
    <span style="color:var(--tok-keyword)">@apply</span> bg-brand-primary text-white px-4 py-2 rounded;
  }
}</code></pre>

        <h3>The Build Process</h3>
        <p>Bastion uses the new <strong>Oxide Engine</strong> (Rust-based) via the CLI. It detects class usage in your PHP files and generates optimized CSS.</p>
        
        <pre><code class="language-bash"><span style="color:var(--text-dim)"># Start JIT Watcher</span>
npm run dev

<span style="color:var(--text-dim)"># Build for Production (Minified)</span>
npm run build</code></pre>
      </section>

      <section id="components">
        <h2>Functional Components</h2>
        <p>
          Instead of heavy Blade/Twig templates, Bastion uses <strong>Functional PHP Components</strong>. 
          They are simple, fast, type-safe, and live in <code>app/components/</code>.
        </p>

        <pre><code class="language-php"><span style="color:var(--tok-comment)">// File: app/components/Badge.php</span>

<span style="color:var(--tok-keyword)">function</span> <span style="color:var(--tok-function)">Badge</span>(<span style="color:var(--tok-variable)">$text</span>, <span style="color:var(--tok-variable)">$color</span> = <span style="color:var(--tok-string)">'blue'</span>) {
    <span style="color:var(--tok-comment)">// Use Heredoc for clean HTML blocks</span>
    <span style="color:var(--tok-keyword)">return</span> &lt;&lt;&lt;HTML
    &lt;span class="px-2 py-1 rounded bg-{<span style="color:var(--tok-variable)">$color</span>}-100 text-{<span style="color:var(--tok-variable)">$color</span>}-800 text-xs font-bold"&gt;
        {<span style="color:var(--tok-variable)">$text</span>}
    &lt;/span&gt;
    HTML;
}
</code></pre>

        <p>To use a component in a View/Page:</p>
        <pre><code class="language-php"><span style="color:var(--tok-function)">&lt;?=</span> <span style="color:var(--tok-function)">component</span>(<span style="color:var(--tok-string)">'Badge'</span>, [<span style="color:var(--tok-string)">'text'</span> => <span style="color:var(--tok-string)">'Admin'</span>, <span style="color:var(--tok-string)">'color'</span> => <span style="color:var(--tok-string)">'purple'</span>]) <span style="color:var(--tok-function)">?&gt;</span></code></pre>
      </section>

      <section id="htmx-integration">
        <h2>HTMX Integration</h2>
        <p>
          Bastion is designed to be the perfect backend for <strong>HTMX</strong>. 
          The API routes can return HTML fragments (using components) or JSON depending on the header context.
        </p>

        <pre><code class="language-html">&lt;!-- Delete a user row without full page reload --&gt;
&lt;button 
    hx-delete="/api/users/1" 
    hx-target="closest tr" 
    hx-swap="outerHTML"
    class="text-red-500"&gt;
    Delete
&lt;/button&gt;</code></pre>
      </section>

      <hr />

      <section id="security">
  <h2>Security Protocols</h2>
  <p>
    Bastion assumes the environment is hostile. It implements a
    <strong>Defense in Depth</strong> strategy: hardened headers, strict CSRF
    validation, safe rendering helpers, and a clear token model.
  </p>

  <div class="features-grid">
    <div class="feature-card">
      <h4 style="margin-top:0; color:var(--primary)">Native JWT</h4>
      <p style="font-size:0.9rem;">
        Zero-dependency implementation using OpenSSL. Handles
        <code>HttpOnly</code> cookies for Refresh Tokens automatically, while
        the access token is short-lived and scoped to the current session.
      </p>
    </div>
    <div class="feature-card">
      <h4 style="margin-top:0; color:var(--accent)">CSRF Fortress</h4>
      <p style="font-size:0.9rem;">
        Middleware automatically verifies tokens on all state-changing methods
        (POST, PUT, PATCH, DELETE). Integrated with HTMX via a dedicated
        <code>X-CSRF-Token</code> header or hidden form fields.
      </p>
    </div>
    <div class="feature-card">
      <h4 style="margin-top:0; color:var(--warning)">XSS Prevention</h4>
      <p style="font-size:0.9rem;">
        The global <code>e()</code> helper escapes HTML output, and security
        middleware sets strict Content Security Policy headers by default to
        reduce the impact of script injection.
      </p>
    </div>
  </div>

  <h3>XSS Protection with <code>e()</code></h3>
  <p>
    All untrusted data should be escaped before it reaches your HTML. Bastion
    provides a small global helper <code>e()</code> that escapes HTML entities
    and prevents XSS when rendering user-controlled values in templates,
    layouts or components.
  </p>

  <pre><code class="language-php">&lt;?php
// Somewhere in a page or layout:

$user = auth(); // returns current user or null

if ($user) {
    echo 'Logged in as: ' . e($user['email']);
}
</code></pre>

  <p>
    Always wrap dynamic strings that might contain user input with
    <code>e()</code>, especially when printing into HTML attributes or text
    nodes. For values coming from the DV engine, a common pattern is:
  </p>

  <pre><code class="language-php">&lt;title&gt;&lt;?= e(dv('title', 'Bastion App')) ?&gt;&lt;/title&gt;</code></pre>

  <h3>CSRF Protection</h3>
  <p>
    State-changing requests (POST, PUT, PATCH, DELETE) are protected by a CSRF
    middleware. Forms must include a valid token, and HTMX / AJAX requests
    should send the token via a dedicated header. If the token is missing or
    invalid, the middleware will reject the request with a 419/403 response.
  </p>

  <h4>HTML forms</h4>
  <p>
    Use the <code>csrf_field()</code> helper inside your forms. It renders a
    hidden input with the current CSRF token so you don't have to wire it by
    hand:
  </p>

  <pre><code class="language-php">&lt;form method="POST" action="/users/create"&gt;
    &lt;input type="text" name="name" required&gt;
    &lt;input type="email" name="email" required&gt;

    &lt;!-- CSRF Token --&gt;
    &lt;?= csrf_field() ?&gt;

    &lt;button type="submit"&gt;Create User&lt;/button&gt;
&lt;/form&gt;
</code></pre>

  <h4>HTMX integration</h4>
  <p>
    A common pattern is to expose the token in a meta tag from your base layout
    and configure HTMX to send it automatically on every request:
  </p>

  <pre><code class="language-php">&lt;!-- In your base layout (e.g. app/views/layouts/app.php) --&gt;
&lt;head&gt;
  ...
  &lt;meta name="csrf-token" content="&lt;?= csrf_token() ?&gt;"&gt;
&lt;/head&gt;
</code></pre>

  <pre><code class="language-js">// In your app.js or inline script
document.body.addEventListener('htmx:configRequest', (event) =&gt; {
  const tokenMeta = document.querySelector('meta[name="csrf-token"]');
  if (tokenMeta) {
    event.detail.headers['X-CSRF-Token'] = tokenMeta.getAttribute('content');
  }
});
</code></pre>

  <p style="font-size:0.9rem; color:var(--text-dim);">
    The CSRF middleware validates the token from either a hidden form field
    (e.g. <code>_csrf</code> via <code>csrf_field()</code>) or the
    <code>X-CSRF-Token</code> header, making server-driven and HTMX-driven
    interactions equally safe.
  </p>
</section>

      <section id="cli">
        <h2>The Bastion CLI</h2>
        <p>The <code>bastion</code> executable (at project root) replaces Artisan. It is lightweight and fast.</p>

        <div class="table-wrapper">
          <table>
            <thead><tr><th>Command</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>php bastion serve</code></td><td>Start local dev server (127.0.0.1:8000).</td></tr>
              <tr><td><code>php bastion migrate</code></td><td>Run pending migrations.</td></tr>
              <tr><td><code>php bastion db:seed</code></td><td>Seed database with fake data.</td></tr>
              <tr><td><code>php bastion make:page</code></td><td>Scaffold a new UI Route directory.</td></tr>
              <tr><td><code>php bastion make:api</code></td><td>Scaffold a new API Endpoint.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="deployment">
        <h2>Deployment</h2>
        <p>Deploying Bastion is straightforward as it relies on standard PHP technologies.</p>

        <h3>Requirements</h3>
        <ul>
          <li>PHP 8.1+ (FPM)</li>
          <li>Nginx or Apache</li>
          <li>SQLite, MySQL, or PostgreSQL</li>
        </ul>

        <h3>Nginx Configuration</h3>
        <p>Point your web server root to the <code>public/</code> directory. Ensure <code>storage/</code> is not accessible via web.</p>

        <pre><code class="language-nginx">server {
    listen 80;
    server_name tool.internal;
    root /var/www/bastion/public;
    
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
    
    # Security: Block hidden files
    location ~ /\.(?!well-known).* {
        deny all;
    }
}</code></pre>
      </section>

      <footer style="margin-top: 6rem; border-top: 1px solid var(--border-dim); padding: 4rem 0; text-align: center; color: var(--text-muted);">
        <p style="font-weight: 700; color: #fff; font-size: 1.5rem; margin-bottom: 1rem;">Bastion Enterprise v1.0.0</p>
        <p>Forged for the bold. Built for production.</p>
        <p style="font-size: 0.85rem; margin-top: 2rem;">&copy; 2025 Bastion Framework. Released under MIT License.</p>
      </footer>

    </div>
  </main>
</div>

<script>
  const links = document.querySelectorAll('.nav-link');
  const sections = document.querySelectorAll('section');

  window.addEventListener('scroll', () => {
    let current = '';
    sections.forEach(section => {
      const sectionTop = section.offsetTop;
      if (pageYOffset >= sectionTop - 150) {
        current = section.getAttribute('id');
      }
    });

    links.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href').includes(current)) {
        link.classList.add('active');
      }
    });
  });
</script>

</body>
</html>
