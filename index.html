<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--
    ESTA PÁGINA ES SOLO LA DOCUMENTACIÓN DEL FRAMEWORK BASTION PHP.
    NO ES EL LAYOUT REAL DE LA APP, ES UNA PÁGINA ESTÁTICA PARA DEV.
  -->

  <!--
    <title>:
    Aquí ponemos un título fijo para la documentación.
    En la app real, el título se controla con DV::set('title', ...) desde page.php.
  -->
  <title>Bastion PHP 0.1.0 – Developer Documentation</title>

  <!--
    VIEWPORT:
    Necesario para que sea responsive en celulares y pantallas chicas.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--
    TAILWIND CSS POR CDN:
    - Esto SOLO es para esta página de docs.
    - El framework Bastion ya soporta Tailwind "por defecto" en los layouts reales,
      pero aquí lo cargamos por CDN para no complicar al dev.
    - En producción puedes usar compilado, pero esta docs page se queda así.
  -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!--
    ESTILOS SIMPLES EXTRA:
    Sólo para que el código y el scroll se vean mejor.
  -->
  <style>
    html, body { scroll-behavior: smooth; }
    pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<!--
  BODY:
  - Fondo oscuro tipo "dev docs".
  - Tipografía clara.
-->
<body class="bg-slate-950 text-slate-100 min-h-screen">

<!--
  HEADER:
  - Barra fija arriba con el nombre del framework.
-->
<header class="border-b border-slate-800 bg-slate-900/80 px-4 py-3 sticky top-0 z-50 backdrop-blur">
  <div class="max-w-6xl mx-auto flex items-center gap-3">
    <!-- Logo mínimo de Bastion PHP -->
    <div class="h-9 w-9 flex items-center justify-center bg-cyan-500/10 border border-cyan-500/40 rounded-lg text-xs font-semibold text-cyan-300">
      BP
    </div>
    <div>
      <h1 class="text-xl font-bold">
        Bastion PHP <span class="text-xs font-normal text-slate-400">v0.1.0</span>
      </h1>
      <p class="text-xs text-slate-500">
        Secure, file-based, zero-magic PHP framework generator
      </p>
    </div>
  </div>
</header>

<!--
  MAIN:
  - Contenedor principal de todas las secciones de documentación.
-->
<main class="max-w-6xl mx-auto px-4 py-8 space-y-16">

  <!-- ========================================================= -->
  <!-- 1. OVERVIEW                                               -->
  <!-- ========================================================= -->
  <section id="overview" class="space-y-3">
    <h2 class="text-3xl font-bold border-l-4 border-cyan-500 pl-3">1. Overview</h2>

    <p class="text-sm text-slate-300">
      Bastion PHP es un framework que se genera con un script (por ejemplo <code>create-bastion-app</code>) y te deja
      una estructura lista para producción con:
    </p>

    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li>Ruteo por carpetas tipo Next.js (<code>page.php</code>, <code>layout.php</code>, <code>[param]</code>).</li>
      <li>Endpoints tipo FastAPI/SvelteKit con <code>+server.php</code> (uno por carpeta de API).</li>
      <li>Seguridad: CSP con nonce, CSRF tokens, cookies SameSite/HttpOnly, escape global <code>e()</code>.</li>
      <li>DV Engine: bolsa de datos global para metadatos (título, breadcrumbs, flags).</li>
      <li>ORM-like QueryBuilder con <code>DB::table()</code> usando PDO y SQLite + WAL por defecto.</li>
      <li>Componentes tipo React en PHP (server-side) y componentes interactivos con HTMX en el cliente.</li>
      <li>CLI <code>bastion</code> para migraciones, seeds, dev server, generation, etc.</li>
    </ul>
  </section>

  <!-- ========================================================= -->
  <!-- 2. ESTRUCTURA GENERADA                                   -->
  <!-- ========================================================= -->
  <section id="structure" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-emerald-500 pl-3">2. Generated Project Structure</h2>

    <p class="text-sm text-slate-300">
      Cuando corres el script de creación, Bastion genera una estructura de carpetas con responsabilidades claras:
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs overflow-x-auto">
app/                        → Toda la lógica de rutas (páginas y APIs).
  layout.php                → Layout raíz. Envuelve TODAS las páginas.
  page.php                  → Página raíz "/" (solo el contenido, sin &lt;html&gt; ni &lt;head&gt;).
  Core/                     → Núcleo del framework:
    App.php                 → Boot general, registra servicios, ejecuta middlewares, llama al router.
    Router.php              → Router por archivos: mapea URL → page.php o +server.php.
    Request.php             → Normaliza PETICIÓN: método, headers, query, body, params dinámicos.
    Response.php            → Helpers para responder JSON, HTML, redirecciones, abortos.
    DB.php                  → Conexión PDO + QueryBuilder (DB::table(...)).
    DV.php                  → Data View Engine, guarda metadatos (título, etc).
    Auth.php                → Manejo de JWT y usuario autenticado.
    CSRF.php                → CSRF tokens (generación y validación).
    Logger.php              → Logger simple a storage/logs/app.log.
    helpers.php             → Helpers globales (e(), env(), req(), res(), auth(), csrf_token(), etc).
  Middleware/
    SecurityHeaders.php     → Aplica headers de seguridad + CSP con nonce.
    AuthMiddleware.php      → Resuelve usuario, valida CSRF en métodos peligrosos.
    AdminOnly.php           → Restringe rutas administrativas a usuarios admin.
  Models/
    User.php                → Modelo de usuario con métodos estáticos (find, findByEmail, create, etc).
  admin/
    layout.php              → Layout para toda la sección /admin.
    page.php                → Página principal /admin.
  api/
    products/
      +server.php           → Endpoints GET/POST /api/products.
      [Id]/
        +server.php         → Endpoints GET/PUT/DELETE /api/products/{Id}.
config/
  app.php                   → Config general de la app (APP_ENV, APP_DEBUG, etc).
  database.php              → Config de base de datos (sqlite por default).
  security.php              → Configs de seguridad (CSRF_ENABLED, SECURE_COOKIES, etc).
  style.php                 → Config de estilos (Tailwind, theme, etc).
database/
  migrations/               → Migraciones SQL puras.
  seeds/                    → Seeders para poblar datos iniciales.
public/
  index.php                 → Front controller: entra aquí TODO request HTTP.
  css/fallback.css          → CSS mínimo por si no usas Tailwind.
storage/
  db/app.db                 → Base de datos SQLite.
  logs/app.log              → Archivo de logs.
bastion                     → CLI principal del framework.
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 3. CONFIGURACIÓN (ENV + CONFIG/*.PHP + TAILWIND)         -->
  <!-- ========================================================= -->
  <section id="config" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-yellow-500 pl-3">3. Configuration (ENV + config/*.php + Tailwind)</h2>

    <!-- .env -->
    <h3 class="text-xl font-semibold text-slate-200">3.1 .env</h3>
    <p class="text-sm text-slate-300">
      Bastion usa un archivo <code>.env</code> para variables sensibles. Ejemplo:
    </p>
<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
APP_ENV=development
APP_DEBUG=true
APP_KEY=base64:GENERATED_KEY_HERE

DB_CONNECTION=sqlite
DB_PATH=storage/db/app.db

JWT_SECRET=super-secret-jwt-key
JWT_TTL=900          # 15 minutos
JWT_REFRESH_TTL=604800 # 7 días

SECURE_COOKIES=false
CSRF_ENABLED=true
</pre>

    <!-- config/app.php -->
    <h3 class="text-xl font-semibold text-slate-200">3.2 config/app.php</h3>
    <p class="text-sm text-slate-300">
      Archivo donde se mapean valores de <code>.env</code> a un arreglo de configuración:
    </p>
<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// config/app.php
return [
  'name' => 'Bastion App',
  'env'  => env('APP_ENV','production'),
  'debug'=> env('APP_DEBUG', false),
];
</pre>

    <!-- config/style.php + Tailwind -->
    <h3 class="text-xl font-semibold text-slate-200">3.3 config/style.php (Tailwind por defecto)</h3>
    <p class="text-sm text-slate-300">
      Aquí se decide si se usa Tailwind CDN o compilado. El framework ya viene listo para Tailwind:
    </p>
<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// config/style.php
return [
  'theme'       => 'dark',
  'useTailwind' => true,
  'tailwindMode'=> 'cdn',   // 'cdn' para docs/desarrollo, 'build' para producción compilada
  'fallbackCss' => '/css/fallback.css',
];
</pre>

    <p class="text-xs text-slate-500">
      En los layouts reales, se lee este config y se decide si incluir Tailwind via CDN o usar el CSS compilado.
      En ESTE <code>index.html</code> de docs usamos directamente el CDN para simplificar.
    </p>
  </section>

  <!-- ========================================================= -->
  <!-- 4. DV ENGINE (DATA VIEW)                                 -->
  <!-- ========================================================= -->
  <section id="dv-engine" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-purple-500 pl-3">4. DV Engine (Data View)</h2>

    <p class="text-sm text-slate-300">
      DV es un "bolsón" de datos global que sirve para enviar información desde page.php hacia layout.php
      sin tener que pasar variables entre funciones.
    </p>

    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>DV::set('title', 'Admin · Products')</code> → define el título de la página actual.</li>
      <li><code>DV::get('title', 'Fallback')</code> → se usa en los layouts para renderizar <code>&lt;title&gt;</code>.</li>
    </ul>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// En una page.php (por ejemplo app/admin/products/page.php)
use App\Core\DV;

DV::set('title', 'Admin · Products');

// Más datos que el layout podría usar (ejemplo breadcrumbs)
DV::set('breadcrumbs', ['Admin','Products']);
</pre>

    <p class="text-xs text-slate-500">
      Si por alguna razón no usas DV, también soporta <code>$GLOBALS['title'] = '...'</code>, pero DV es la forma recomendada.
    </p>
  </section>

  <!-- ========================================================= -->
  <!-- 5. REQUEST, RESPONSE, HELPERS req() y res()              -->
  <!-- ========================================================= -->
  <section id="request-response" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-blue-500 pl-3">5. Request, Response &amp; Helpers req()/res()</h2>

    <p class="text-sm text-slate-300">
      Bastion envuelve la petición HTTP en un objeto <code>Request</code> y la respuesta en un helper <code>Response</code>.
      Para hacerlos fáciles de usar, existen helpers globales:
    </p>

    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>req()</code> → devuelve el objeto <code>Request</code> actual.</li>
      <li><code>res()</code> → devuelve un objeto/fachada para responder (usa internamente <code>Response</code>).</li>
    </ul>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// Ejemplo rápido en cualquier parte del código:
$userAgent = req()-&gt;headers['User-Agent'] ?? 'unknown';

res()-&gt;json([
  'message' =&gt; 'Hola desde Bastion',
  'ua'      =&gt; $userAgent,
]);
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 6. DB & QUERYBUILDER                                     -->
  <!-- ========================================================= -->
  <section id="db" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-emerald-500 pl-3">6. Database &amp; QueryBuilder (tipo ORM)</h2>

    <p class="text-sm text-slate-300">
      La capa de base de datos NO es un ORM gigante, pero sí te evita escribir SQL repetitivo.
      Usa <code>DB::table('tabla')</code> con métodos encadenables.
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
$admins = DB::table('users')
  -&gt;where('role','admin')
  -&gt;orderBy('id','DESC')
  -&gt;limit(10)
  -&gt;get();   // devuelve array de filas
</pre>

    <p class="text-xs text-slate-500">
      Siempre que imprimas algo en HTML, usa <code>e($valor)</code> para evitar XSS.
    </p>
  </section>

  <!-- ========================================================= -->
  <!-- 7. COMPONENTES (SERVER + CLIENT CON HTMX)                -->
  <!-- ========================================================= -->
  <section id="components" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-pink-500 pl-3">7. Components (Server-side &amp; HTMX Client)</h2>

    <p class="text-sm text-slate-300">
      En Bastion, un "componente" es simplemente una función PHP que devuelve un string HTML.
      Hay dos sabores:
    </p>

    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><strong>Server-side:</strong> solo HTML estático, reusable.</li>
      <li><strong>Client-interactive (HTMX):</strong> HTML con atributos <code>hx-*</code> para recargar fragmentos.</li>
    </ul>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// COMPONENTE SERVER-SIDE (no HTMX): resources/views/components/ProductCard.php
function ProductCard(array $product): string {
  return "
    &lt;article class='p-4 border border-slate-800 rounded-xl'&gt;
      &lt;h3 class='font-bold'&gt;".e($product['name'])."&lt;/h3&gt;
      &lt;p&gt;$ ".e($product['price'])."&lt;/p&gt;
    &lt;/article&gt;
  ";
}
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 8. LAYOUT Y PAGE.PHP                                     -->
  <!-- ========================================================= -->
  <section id="layout-page" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-indigo-500 pl-3">8. Layout &amp; page.php</h2>

    <!-- Layout -->
    <h3 class="text-xl font-semibold text-slate-200">8.1 app/layout.php (layout raíz)</h3>
    <p class="text-sm text-slate-300">
      Este archivo envuelve todas las páginas. Aquí se coloca:
      <strong>HTML &lt;html&gt;,&lt;head&gt;,&lt;body&gt;</strong>, script tags, CSS, etc.
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// FILE: app/layout.php
// - Se ejecuta para todas las rutas.
// - Lee el título desde DV.
// - Obtiene el nonce CSP desde req()->meta.

use App\Core\DV;
use function App\Core\e;

$title = DV::get('title', 'Bastion App');
$nonce = req()-&gt;meta['csp_nonce'] ?? '';
?&gt;
&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;&lt;?= e($title) ?&gt;&lt;/title&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;!-- Aquí podrías incluir Tailwind o CSS compilado --&gt;
  &lt;link rel="stylesheet" href="/css/fallback.css"&gt;
&lt;/head&gt;
&lt;body class="bg-slate-950 text-slate-100"&gt;
  &lt;!-- $content contiene el HTML renderizado de page.php --&gt;
  &lt;div class="p-4"&gt;&lt;?= $content ?&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>

    <!-- page.php -->
    <h3 class="text-xl font-semibold text-slate-200">8.2 app/admin/products/page.php</h3>
    <p class="text-sm text-slate-300">
      Las páginas <code>page.php</code> SOLO pintan el interior del &lt;body&gt;, no el documento completo.
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// FILE: app/admin/products/page.php
use App\Core\DV;
use App\Core\DB;

// 1. Título de la página
DV::set('title','Admin · Products');

// 2. Cargamos productos desde la base de datos
$products = DB::table('products')-&gt;orderBy('id','DESC')-&gt;get();
?&gt;

&lt;section class="space-y-4"&gt;
  &lt;h2 class="text-xl font-bold"&gt;Products&lt;/h2&gt;

  &lt;div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"&gt;
    &lt;?php foreach ($products as $p) : ?&gt;
      &lt;?= ProductCard($p) ?&gt;
    &lt;?php endforeach; ?&gt;
  &lt;/div&gt;
&lt;/section&gt;
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 9. PRODUCTS API ENDPOINTS (USANDO req() Y res())         -->
  <!-- ========================================================= -->
  <section id="api-products" class="space-y-6">
    <h2 class="text-3xl font-bold border-l-4 border-red-500 pl-3">9. Products API Endpoints (req() &amp; res())</h2>

    <p class="text-sm text-slate-300">
      En Bastion, cada carpeta debajo de <code>app/api</code> tiene un archivo <code>+server.php</code> que devuelve
      un arreglo donde las claves son métodos HTTP (get, post, put, delete, etc) y los valores son funciones.
    </p>

    <!-- api/products/+server.php -->
    <h3 class="text-xl font-semibold text-slate-200">9.1 app/api/products/+server.php</h3>
    <p class="text-xs text-slate-400">
      Endpoint para colecciones: <code>GET /api/products</code> y <code>POST /api/products</code>.
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// FILE: app/api/products/+server.php
use App\Core\DB;

// Nota: usamos helpers globales req() y res() aquí DENTRO del endpoint.

return [

  // GET /api/products
  'get' =&gt; function($req) {
    // $req es el Request actual, pero también podríamos usar req()
    $limit = $req-&gt;input('limit') ?? 50;

    $rows = DB::table('products')
      -&gt;orderBy('id','DESC')
      -&gt;limit((int)$limit)
      -&gt;get();

    // res() es un helper que manda JSON y cierra la respuesta
    res()-&gt;json([
      'data'  =&gt; $rows,
      'count' =&gt; count($rows),
      'limit' =&gt; (int)$limit,
    ]);
  },

  // POST /api/products
  'post' =&gt; function($req) {
    try {
      // validamos datos de entrada
      $data = $req-&gt;validate([
        'name'  =&gt; 'required|min:2',
        'price' =&gt; 'required|numeric|min:0',
      ]);

      // insertamos en la DB
      $id = DB::table('products')-&gt;insert([
        'name'       =&gt; $data['name'],
        'price'      =&gt; (float) $data['price'],
        'created_at' =&gt; time(),
        'created_by' =&gt; auth()['id'] ?? 0,
      ]);

      res()-&gt;json([
        'id'      =&gt; $id,
        'created' =&gt; true,
      ], 201);

    } catch (\App\Core\ValidationException $e) {
      // si falla la validación, devolvemos errores estandarizados
      res()-&gt;json(['errors' =&gt; $e-&gt;errors], 422);
    }
  },
];
</pre>

    <!-- api/products/[Id]/+server.php -->
    <h3 class="text-xl font-semibold text-slate-200">9.2 app/api/products/[Id]/+server.php</h3>
    <p class="text-xs text-slate-400">
      Endpoint para un recurso específico: <code>/api/products/{Id}</code>.
      El parámetro dinámico {Id} se encuentra en <code>$req-&gt;meta['params']['Id']</code>.
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
&lt;?php
// FILE: app/api/products/[Id]/+server.php
use App\Core\DB;

return [

  // GET /api/products/{Id}
  'get' =&gt; function($req) {
    // Leemos el ID que vino de la URL
    $id = (int) $req-&gt;meta['params']['Id'];

    $row = DB::table('products')-&gt;where('id',$id)-&gt;first();

    if (!$row) {
      // si no existe, respondemos 404
      res()-&gt;abort(404,'Product not found');
    }

    res()-&gt;json($row);
  },

  // PUT /api/products/{Id}
  'put' =&gt; function($req) {
    $id = (int) $req-&gt;meta['params']['Id'];

    try {
      $data = $req-&gt;validate([
        'name'  =&gt; 'sometimes|min:2',
        'price' =&gt; 'sometimes|numeric|min:0',
      ]);

      if (empty($data)) {
        res()-&gt;json(['updated' =&gt; false, 'message' =&gt; 'No data'], 400);
      }

      DB::table('products')-&gt;where('id',$id)-&gt;update($data);

      res()-&gt;json(['id' =&gt; $id, 'updated' =&gt; true]);

    } catch (\App\Core\ValidationException $e) {
      res()-&gt;json(['errors' =&gt; $e-&gt;errors], 422);
    }
  },

  // DELETE /api/products/{Id}
  'delete' =&gt; function($req) {
    $id = (int) $req-&gt;meta['params']['Id'];

    DB::table('products')-&gt;where('id',$id)-&gt;delete();

    res()-&gt;json(['deleted' =&gt; true, 'id' =&gt; $id]);
  },
];
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 10. MIDDLEWARE & SECURITY                                -->
  <!-- ========================================================= -->
  <section id="middleware" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-teal-500 pl-3">10. Middleware &amp; Security</h2>

    <p class="text-sm text-slate-300">
      Antes de llegar a una página o endpoint, la petición pasa por varios middlewares:
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
SecurityHeaders → AuthMiddleware → Router → page.php / +server.php
</pre>
  </section>

  <!-- ========================================================= -->
  <!-- 11. MIGRACIONES & SEEDS                                  -->
  <!-- ========================================================= -->
  <section id="migrations" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-lime-500 pl-3">11. Migrations &amp; Seeds</h2>

    <p class="text-sm text-slate-300">
      Bastion usa migraciones en SQL puro para que tengas control total:
    </p>

<pre class="bg-slate-950/80 border border-slate-800 rounded-xl p-3 text-xs overflow-x-auto">
-- database/migrations/001_create_products.sql
CREATE TABLE IF NOT EXISTS products (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  price REAL NOT NULL,
  created_at INTEGER NOT NULL,
  created_by INTEGER NOT NULL
);
</pre>

    <p class="text-xs text-slate-500">
      Ejecuta todas las migraciones con: <code>./bastion migrate</code>.
    </p>
  </section>

  <!-- ========================================================= -->
  <!-- 12. CLI                                                   -->
  <!-- ========================================================= -->
  <section id="cli" class="space-y-4">
    <h2 class="text-3xl font-bold border-l-4 border-orange-500 pl-3">12. CLI (bastion)</h2>

    <p class="text-sm text-slate-300">
      El script <code>bastion</code> te ayuda a manejar el proyecto:
    </p>

    <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
      <li><code>./bastion run-dev</code> → servidor de desarrollo.</li>
      <li><code>./bastion migrate</code> → corre migraciones.</li>
      <li><code>./bastion seed</code> → corre seeders.</li>
      <li><code>./bastion key:generate</code> → genera APP_KEY.</li>
      <li><code>./bastion jwt:secret</code> → genera JWT_SECRET.</li>
    </ul>
  </section>

  <!-- ========================================================= -->
  <!-- 13. DOCS ROUTING WIZARD (INTERACTIVO)                    -->
  <!-- ========================================================= -->
  <section id="routing-wizard" class="space-y-4 pb-12">
    <h2 class="text-3xl font-bold border-l-4 border-indigo-500 pl-3">13. Docs Routing Wizard</h2>

    <p class="text-sm text-slate-300">
      Es una herramienta visual en esta misma página para entender cómo el router de Bastion
      resuelve una URL a un archivo físico y a qué layouts afecta.
    </p>

    <div class="bg-slate-900/40 border border-slate-700 rounded-xl p-5 shadow-lg space-y-3">
      <input
        id="routeInput"
        type="text"
        placeholder="/api/products/10"
        class="w-full bg-slate-950 text-slate-200 border border-slate-800 rounded-xl p-2 text-sm placeholder-slate-400 focus:ring-2 focus:ring-indigo-400"
      >
      <button
        id="resolveBtn"
        class="mt-2 w-full sm:w-auto px-4 py-2 bg-indigo-500/10 border border-indigo-500/40 text-indigo-300 rounded-xl hover:bg-indigo-500/20 transition text-sm font-medium"
      >
        Resolve Route
      </button>

      <pre
        id="wizardResult"
        class="mt-4 bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-xs text-slate-200 overflow-auto"
      ></pre>
    </div>
  </section>

</main>

<footer class="border-t border-slate-800 py-4 text-center text-xs text-slate-500">
  Bastion PHP 0.1.0 · Secure &amp; Fast PHP framework for internal tools
</footer>

<!-- ========================================================= -->
<!-- SCRIPT DEL ROUTING WIZARD (VANILLA JS)                    -->
<!-- ========================================================= -->
<script>
  // Función para simular cómo el router de Bastion resuelve una ruta.
  function simulateRoute(path) {
    const clean = path.trim().replace(/^\/+/, '');   // quitamos "/" inicial
    const segs = clean ? clean.split('/').filter(Boolean) : [];

    let type  = 'page';
    let file  = 'app/page.php';
    let layouts = ['app/layout.php'];
    let params  = {};

    if (segs[0] === 'api') {
      type = 'api';
      const resource = segs[1] || '';

      if (resource === 'products') {
        if (segs.length === 2) {
          // /api/products
          file = 'app/api/products/+server.php';
        } else if (segs.length >= 3) {
          // /api/products/{Id}
          const id = segs[2];
          file = 'app/api/products/[Id]/+server.php';
          params['Id'] = id;
        }
      } else {
        // Otro recurso de API genérico
        file = 'app/api/' + resource + '/+server.php';
      }
    } else if (segs.length === 0) {
      // Ruta raíz "/"
      file = 'app/page.php';
    } else {
      // cualquier otra página: /admin /admin/products etc
      file = 'app/' + clean + '/page.php';
    }

    // calculamos layout stack (tipo Next.js):
    let walker = 'app';
    for (const s of segs) {
      if (s === 'api') continue; // API normalmente no usa layouts de páginas
      walker += '/' + s;
      layouts.push(walker + '/layout.php');
    }
    // removemos duplicados
    layouts = [...new Set(layouts)];

    return { type, file, layouts, params };
  }

  // Listeners para el wizard
  document.addEventListener('DOMContentLoaded', () => {
    const input  = document.getElementById('routeInput');
    const button = document.getElementById('resolveBtn');
    const output = document.getElementById('wizardResult');

    button.addEventListener('click', () => {
      const route = input.value || '/';
      const result = simulateRoute(route);

      const lines = [];
      lines.push('Input route: ' + route);
      lines.push('Type      : ' + (result.type === 'api' ? 'API endpoint' : 'Page'));
      lines.push('File      : ' + result.file);
      lines.push('Layouts   :');
      result.layouts.forEach(l => lines.push('  - ' + l));

      if (Object.keys(result.params).length > 0) {
        lines.push('Params    :');
        for (const k in result.params) {
          lines.push(`  ${k} = ${result.params[k]}`);
        }
      } else {
        lines.push('Params    : (none)');
      }

      output.textContent = lines.join('\n');
    });
  });
</script>

</body>
</html>